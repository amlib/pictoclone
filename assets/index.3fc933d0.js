var Xe=Object.defineProperty;var Ge=(e,t,o)=>t in e?Xe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var v=(e,t,o)=>(Ge(e,typeof t!="symbol"?t+"":t,o),o);import{u as Ke,c as se,r as k,o as d,a as f,b as $,t as E,d as B,e as h,f as w,w as S,n as g,g as _,F as T,T as Fe,h as N,i as pe,l as m,j as L,k as fe,m as D,p as ge,v as me,q as be,s as z,x as ye,y as ke,z as He,A as Q,B as ze,C as qe,D as je}from"./vendor.52034c81.js";const We=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function o(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(i){if(i.ep)return;i.ep=!0;const s=o(i);fetch(i.href,s)}};We();const ae=["#b1c2da","#eab999","#FBBABA","#facafa","#fada91","#FBFB71","#c2fa71","#b9faa9","#99ea99","#b1fada","#d2f2fa","#b9cafa","#b9b9f2","#dab9fa","#F3C3FB","#fadaf2"],J=["#697181","#a95928","#FB3041","#e281ea","#fa8108","#FBCB20","#91d201","#18f218","#20a949","#61d289","#61b1da","#2869e2","#5151a9","#9941ca","#e241f2","#fa41a9"],we=["#415969","#913801","#FB0000","#ea30ea","#fa6901","#E3BA00","#69a101","#00c201","#008930","#38c299","#2899ca","#0049ca","#0049ca","#6900a1","#b900d2","#fa0071"],ve=["#303851","#692801","#8A0008","#793059","#894901","#494900","#103801","#005101","#005101","#185130","#104969","#002069","#002069","#410061","#790089","#790089"],Se=["#61829A","#BA4900","#FB0018","#FB8AFB","#FB9200","#F3E300","#AAFB00","#00FB00","#00A238","#49DB8A","#30BAF3","#0059F3","#000092","#8A00D3","#D300EB","#FB0092"],Qe=["#D3DBE3","#F3B28A","#FBA2AA","#FBDBFB","#FBDBAA","#FBFB9A","#E3FBCB","#CBFBCB","#AAEBC3","#BAFBD3","#C3EBFB","#A2CBFB","#7179E3","#DBA2FB","#F3C3FB","#FBAADB"],Je=[203,54,358,300,40,62,73,93,166,164,191,210,250,266,273,334],ws=["#FB0018","#FB9200","#ffef00","#b7ff00","#1fff1f","#00ff59","#00b4ff","#005dff","#0000ff","#a800ff","#e600ff","#ff0094"],F=["samples/pc-keydown.wav","samples/pc-keyup.wav","samples/pc-enter.opus","samples/pc-brushbig.wav","samples/pc-brushsmall.wav","samples/pc-eraser.wav","samples/pc-pen.wav","samples/pc-scroll.wav","samples/pc-deny.opus","samples/pc-click.wav","samples/pc-chirp.wav","samples/pc-symboldrop.wav","samples/pc-send.opus","samples/pc-copy.opus","samples/pc-clear.opus","samples/pc-pen-start.wav","samples/pc-eraser-start.wav","samples/pc-bells.mp3","samples/pc-receive.mp3"],q={"pc-keydown":{sample:"samples/pc-keydown.wav",vibrate:.15,volume:.12},"pc-keyup":{sample:"samples/pc-keyup.wav",vibrate:.4,volume:.16},"pc-enter":{sample:"samples/pc-enter.opus",volume:.5},"pc-brushbigger":{sample:"samples/pc-brushbig.wav",vibrate:1,volume:1.5,rate:.5},"pc-brushbig":{sample:"samples/pc-brushbig.wav",vibrate:.5,volume:1.5},"pc-brushsmall":{sample:"samples/pc-brushsmall.wav",vibrate:.15,volume:1.5},"pc-eraser":{sample:"samples/pc-eraser.wav",vibrate:.2,volume:1.5},"pc-flood":{sample:"samples/pc-pen.wav",vibrate:.2,volume:1.5,rate:.5},"pc-pen":{sample:"samples/pc-pen.wav",vibrate:.2,volume:1.5},"pc-click":{sample:"samples/pc-click.wav",vibrate:.2,volume:2},"pc-scroll":{sample:"samples/pc-scroll.wav",vibrate:.1,volume:2},"pc-deny":{sample:"samples/pc-deny.opus",volume:1.2,vibrate:.5},"pc-chirp-tick":{sample:"samples/pc-chirp.wav",volume:.5,rate:2},"pc-symboldrop":{sample:"samples/pc-symboldrop.wav",volume:1.2,vibrate:.1},"pc-send":{sample:"samples/pc-send.opus",vibrate:.3},"pc-copy":{sample:"samples/pc-copy.opus",vibrate:.3},"pc-clear":{sample:"samples/pc-clear.opus",vibrate:.3},"pc-pen-start":{sample:"samples/pc-pen-start.wav",volume:1.5},"pc-eraser-start":{sample:"samples/pc-eraser-start.wav",volume:1.5},"pc-bells":{sample:"samples/pc-bells.mp3"},"pc-receive":{sample:"samples/pc-receive.mp3",volume:.5},"pc-pen-cp":{complex:function(){this.playProgram("pc-pen-start");let e;this.noiseBuffer?(e=this.audioContext.createBufferSource(),e.buffer=this.noiseBuffer,e.loop=!0,e.playbackRate.setValueAtTime(.7,this.audioContext.currentTime),e.start(0)):e=new AudioWorkletNode(this.audioContext,"white-noise");let t=this.audioContext.createGain();t.gain.setValueAtTime(0,this.audioContext.currentTime);let o=setTimeout(()=>{e.connect(t),t.connect(this.audioContext.destination),o=void 0},68);return{modify:(a,i)=>{let s=Math.min(Math.max(Math.abs(a)*i*.5,0),1.5);s<=.25&&(s=0),t.gain.cancelScheduledValues(this.audioContext.currentTime),t.gain.setValueAtTime(s/100,this.audioContext.currentTime),t.gain.setValueAtTime(s/100,this.audioContext.currentTime+.1),t.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+.15),this.vibrationStrength>0&&window.navigator.vibrate&&window.navigator.vibrate(s*s*this.vibrationStrength*.05)},stop:()=>{o&&clearTimeout(o),e.disconnect(),e=void 0,t.disconnect(),t=void 0}}}},"pc-eraser-cp":{complex:function(){this.playProgram("pc-eraser-start");let e;this.noiseBuffer?(e=this.audioContext.createBufferSource(),e.buffer=this.noiseBuffer,e.loop=!0,e.playbackRate.setValueAtTime(.7,this.audioContext.currentTime),e.start(0)):e=new AudioWorkletNode(this.audioContext,"white-noise");let t=this.audioContext.createGain();t.gain.setValueAtTime(0,this.audioContext.currentTime);let o=setTimeout(()=>{e.connect(t),t.connect(this.audioContext.destination),o=void 0},68),a;const i=.025,s=.03,r=.005,n=.02;return{modify:(c,l)=>{if(a&&this.audioContext.currentTime<a)return;let u=Math.min(Math.max(Math.abs(c)*l,0),1.8);u<=.25&&(u=0);const p=.9+Math.random()*.2,M=.65+u*.5,y=1.65-u*.5,P=i*p*M,I=s*p*y,Y=r*p*M,R=n*p*y;t.gain.setValueAtTime(0,this.audioContext.currentTime),t.gain.linearRampToValueAtTime(u/80,this.audioContext.currentTime+P),t.gain.setValueAtTime(u/80,this.audioContext.currentTime+P+I),t.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+P+I+Y),e.playbackRate.setValueAtTime(0,this.audioContext.currentTime),e.playbackRate.setValueAtTime(.2,this.audioContext.currentTime+P),e.playbackRate.linearRampToValueAtTime(u,this.audioContext.currentTime+P+I+Y),a=this.audioContext.currentTime+P+I+Y+R,this.vibrationStrength>0&&window.navigator.vibrate&&window.navigator.vibrate(u*u*this.vibrationStrength*.1)},stop:()=>{o&&clearTimeout(o),e.disconnect(),e=void 0,t.disconnect(),t=void 0}}}},"pc-flood-cp":{complex:function(){this.playProgram("pc-pen-start");let e=this.audioContext.createOscillator();e.type="square",e.frequency.setValueAtTime(100,this.audioContext.currentTime),e.start(0);let t=this.audioContext.createGain();t.gain.setValueAtTime(0,this.audioContext.currentTime);let o=setTimeout(()=>{e.connect(t),t.connect(this.audioContext.destination),o=void 0},68);return{modify:(a,i)=>{let s=a/i;s=.15+s/1.33,t.gain.cancelScheduledValues(this.audioContext.currentTime),t.gain.setValueAtTime(s/20,this.audioContext.currentTime),e.frequency.linearRampToValueAtTime(210-s*s*200,this.audioContext.currentTime+.025)},stop:()=>{o&&clearTimeout(o),e.disconnect(),e=void 0,t.disconnect(),t=void 0}}}},"pc-flood2-cp":{complex:function(){this.playProgram("pc-pen-start");let e;this.noiseBuffer?(e=this.audioContext.createBufferSource(),e.buffer=this.noiseBuffer,e.loop=!0,e.playbackRate.setValueAtTime(.7,this.audioContext.currentTime),e.start(0)):e=new AudioWorkletNode(this.audioContext,"white-noise");let t=this.audioContext.createGain();t.gain.setValueAtTime(0,this.audioContext.currentTime);let o=setTimeout(()=>{e.connect(t),t.connect(this.audioContext.destination),o=void 0},68);return{modify:(a,i)=>{let s=a/i;s=.15+s/1.33;const r=Math.random();t.gain.cancelScheduledValues(this.audioContext.currentTime),t.gain.setValueAtTime(s/300,this.audioContext.currentTime),t.gain.linearRampToValueAtTime(s/100,this.audioContext.currentTime+.1),t.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+.25),e.playbackRate.linearRampToValueAtTime(s*s+r/4,this.audioContext.currentTime+.025),this.vibrationStrength>0&&window.navigator.vibrate&&window.navigator.vibrate(Math.pow(s,1.4)*this.vibrationStrength*.2)},stop:()=>{o&&clearTimeout(o),e.disconnect(),e=void 0,t.disconnect(),t=void 0}}}}};var Ze="/pictoclone/samples-safari.zip",et="/pictoclone/samples.zip";class tt{constructor(t=120,o=1,a){v(this,"audioContext");v(this,"bufferMap",{});v(this,"vibrationStrength");v(this,"volume");v(this,"loaded",!1);v(this,"noiseBuffer");v(this,"zipSampleBundle",!0);v(this,"isSafari");this.vibrationStrength=t,this.volume=o,this.isSafari=a,a&&this.safariFix(),this.audioContext=new window.AudioContext}safariFix(){for(let t=0;t<F.length;++t)F[t]=F[t].replace(".opus",".caf");for(let t in q)q[t].sample&&(q[t].sample=q[t].sample.replace(".opus",".caf"))}resume(){this.audioContext.state==="suspended"&&this.audioContext.resume()}loadSamples(){return new Promise(async(t,o)=>{if(this.zipSampleBundle){let a;this.isSafari?a=Ze:a=et;const s=await(await fetch(a)).arrayBuffer();Ke(new Uint8Array(s),async(r,n)=>{for(let c=0;c<F.length;++c){const l=F[c];try{const u=n[l.replace("samples/","")];this.bufferMap[l]=await this.audioContext.decodeAudioData(u.buffer)}catch(u){console.warn("AudioFX.loadSamples: could not load sample:",l,"reason:",u),o()}}this.generateNoise(),this.loaded=!0,t()})}else{for(let a=0;a<F.length;++a){const i=F[a];try{const r=await(await fetch(i)).arrayBuffer();this.bufferMap[i]=await this.audioContext.decodeAudioData(r)}catch(s){console.warn("AudioFX.loadSamples: could not load sample:",i,"reason:",s),o()}}this.generateNoise(),this.loaded=!0,t()}})}generateNoise(){const t=this.audioContext.createBuffer(2,this.audioContext.sampleRate*.5,this.audioContext.sampleRate);for(let o=0;o<t.numberOfChannels;o++){const a=t.getChannelData(o);for(let i=0;i<t.length;i++)a[i]=Math.random()*2-1}this.noiseBuffer=t}setVolume(t){this.volume=Math.max(t,0),this.volume<=0?this.audioContext.suspend():this.resume()}setVibrationStrength(t){this.vibrationStrength=t}playProgram(t,o={}){if(!this.loaded)return;const a=q[t];if(!a){console.warn("AudioFX.playProgram: could not find program",t);return}const i=this.bufferMap[a.sample];if(!i){console.warn("AudioFX.playProgram: could not find sample",i);return}if(a.complex){console.warn("AudioFX.playProgram: could not play",t,"because its a complex program");return}const s=o.vibrate?o.vibrate:a.vibrate;if(s!=null&&this.vibrationStrength>0&&window.navigator.vibrate&&window.navigator.vibrate(s*this.vibrationStrength),this.volume<=0)return;const r=this.audioContext.createBufferSource();r.buffer=i;const n=o.rate?o.rate:a.rate;n!=null&&r.playbackRate.setValueAtTime(n,this.audioContext.currentTime);let c=r;const l=o.volume?o.volume:a.volume;if(l!=null){const u=this.audioContext.createGain();u.gain.setValueAtTime(l,this.audioContext.currentTime),c.connect(u),c=u}return c.connect(this.audioContext.destination),r.start(o.delay?o.delay:0),r}startComplexProgram(t){if(!this.loaded)return;const o=q[t];if(!o){console.warn("AudioFX.startComplexProgram: could not find program",t);return}if(!o.complex){console.warn("AudioFX.startComplexProgram: could not play",t,"because its not a complex program");return}return o.complex.call(this)}}const ot=new TextDecoder("utf-8"),st=new TextEncoder("utf-8"),b=Object.freeze(new Map([["MSG_TYPE_GENERIC_ERROR",0],["MSG_TYPE_NEW_CONNECTION_RESULT",1],["MSG_TYPE_CREATE_ROOM",10],["MSG_TYPE_CREATE_ROOM_RESULT",11],["MSG_TYPE_CONNECT_ROOM",12],["MSG_TYPE_CONNECT_ROOM_RESULT",13],["MSG_TYPE_LEAVE_ROOM",14],["MSG_TYPE_LEAVE_ROOM_RESULT",15],["MSG_TYPE_USER_LIST_CHANGE",16],["MSG_TYPE_SEND_CHAT_MESSAGE",20],["MSG_TYPE_SEND_CHAT_MESSAGE_RESULT",21],["MSG_TYPE_RECEIVE_CHAT_MESSAGES",30]])),ie=Object.freeze(new Map([...b].map(e=>[e[1],e[0]]))),at=Object.freeze(new Map([...b].map(e=>[e[1],e[0].match("_RESULT$")!=null])));Object.freeze(new Map([[b.get("MSG_TYPE_GENERIC_ERROR"),-1],[b.get("MSG_TYPE_NEW_CONNECTION_RESULT"),-1],[b.get("MSG_TYPE_CREATE_ROOM"),32],[b.get("MSG_TYPE_CREATE_ROOM_RESULT"),-1],[b.get("MSG_TYPE_CONNECT_ROOM"),64],[b.get("MSG_TYPE_CONNECT_ROOM_RESULT"),-1],[b.get("MSG_TYPE_LEAVE_ROOM"),32],[b.get("MSG_TYPE_LEAVE_ROOM_RESULT"),-1],[b.get("MSG_TYPE_SEND_CHAT_MESSAGE"),32*1024],[b.get("MSG_TYPE_SEND_CHAT_MESSAGE_RESULT"),-1],[b.get("MSG_TYPE_RECEIVE_CHAT_MESSAGES"),-1]]));const it=Object.freeze(new Map([["ERROR_GENERIC_ERROR",0],["ERROR_NO_UNIQUE_ID",1],["ERROR_INVALID_UNIQUE_ID",2],["ERROR_INVALID_USER_NAME",3],["ERROR_INVALID_COLOR_INDEX",4],["ERROR_MESSAGE_RESULT_REJECTED",10],["ERROR_MESSAGE_RESULT_TIMEOUT",11],["ERROR_MESSAGE_RESULT_NO_PROMISE",12],["ERROR_MESSAGE_RESULT_EXPIRED",13],["ERROR_MESSAGE_UNIMPLEMENTED_MESSAGE_TYPE",14],["ERROR_ROOM_ALREADY_EXISTS",20],["ERROR_ROOM_DOES_NOT_EXISTS",21],["ERROR_ROOM_NO_FREE_SLOTS",22],["ERROR_ROOM_USER_ALREADY_TAKEN",23],["ERROR_ROOM_NOT_IN_ANY_ROOM",24],["ERROR_ROOM_ALREADY_IN_A_ROOM",25],["ERROR_CHAT_MESSAGE_INVALID_IMAGE",30]])),_e=Object.freeze(new Map([...it].map(e=>[e[1],e[0]]))),Re=9,nt=10,rt=function(e){const t=new DataView(e),o=t.getUint8(0),a=Number(t.getBigUint64(1));return{message:{type:o,uniqueId:a},payloadOffset:Re}},lt=function(e,t,o){return ct.get(e.type)(e,t,o)},V=function(e,t,o=null){const i=new DataView(e,t).getUint32(0);return{string:ot.decode(new Uint8Array(e,t+4,o!=null&&i>o?o:i)),newPayloadOffset:t+4+i}},ct=Object.freeze(new Map([[0,function(e,t,o){const a=new DataView(t,o);e.errorCode=a.getUint8(0);let{string:i,newPayloadOffset:s}=V(t,o+1);return e.errorMessage=i,s}],[1,function(e,t,o){return 0}],[10,function(e,t,o){return 0}],[11,function(e,t,o){const a=new DataView(t,o);if(e.success=a.getUint8(0),e.success)return e.code=a.getUint32(1),5;console.log("unimplemented")}],[12,function(e,t,o){const a=new DataView(t,o);e.code=a.getUint32(0),e.colorIndex=a.getUint8(4);let{string:i,newPayloadOffset:s}=V(t,o+5);return e.userName=i,s}],[13,function(e,t,o){const a=new DataView(t,o);if(e.success=a.getUint8(0),e.success){e.publicId=a.getUint32(1);const i=a.getUint8(5);e.userList=new Array(i);let s=o+1+4+1;for(let r=0;r<i;++r){const n={};e.userList[r]=n;let c=new DataView(t,s);c.getUint32(0),n.publicId=c.getUint32(4),n.colorIndex=c.getUint8(8);let l,u;({string:l,newPayloadOffset:u}=V(t,s+9)),n.userName=l,s=u}return s}else{e.errorCode=a.getUint8(1);let{string:i,newPayloadOffset:s}=V(t,o+2,nt*4);return e.errorMessage=i,s}}],[14,function(e,t,o){return 0}],[15,function(e,t,o){const a=new DataView(t,o);if(e.success=a.getUint8(0),e.success)return 1;{e.errorCode=a.getUint8(1);let{string:i,newPayloadOffset:s}=V(t,o+2);return e.errorMessage=i,s}}],[16,function(e,t,o){const i=new DataView(t,o).getUint8(0);e.userList=new Array(i);let s=o+1;for(let r=0;r<i;++r){const n={};e.userList[r]=n;let c=new DataView(t,s);c.getUint32(0),n.publicId=c.getUint32(4),n.colorIndex=c.getUint8(8);let l,u;({string:l,newPayloadOffset:u}=V(t,s+9)),n.userName=l,s=u}return s}],[20,function(e,t,o){let a=new DataView(t,o);e.timestamp=a.getBigInt64(0);let{string:i,newPayloadOffset:s}=V(t,o+8);e.text=i,a=new DataView(t,s);const r=a.getUint32(0),n=new SharedArrayBuffer(r),c=new Uint8Array(n);return c.set(new Uint8Array(t,s+4,r)),e.image=c,s}],[21,function(e,t,o){const a=new DataView(t,o);if(e.success=a.getUint8(0),e.success)return 1;{e.errorCode=a.getUint8(1);let{string:i,newPayloadOffset:s}=V(t,o+2);return e.errorMessage=i,s}}],[30,function(e,t,o){const i=new DataView(t,o).getUint8(0);e.chatMessages=new Array(i);let s=o+1;for(let r=0;r<i;++r){const n={};e.chatMessages[r]=n;let c=new DataView(t,s);c.getUint32(0),n.timestamp=Number(c.getBigInt64(4)),n.colorIndex=c.getUint8(12);let l,u;({string:l,newPayloadOffset:u}=V(t,s+13)),n.text=l,{string:l,newPayloadOffset:u}=V(t,u),n.userName=l,s=u,c=new DataView(t,s);const p=c.getUint32(0);n.image=new Uint8Array(t,s+4,p),s=s+4+p}return s}]])),ut=function(e,t){const o=new DataView(t);o.setUint8(0,e.type),o.setBigUint64(1,BigInt(e.uniqueId))},dt=function(e){const t=ht.get(e.type)(e,Re);return ut(e,t),t},O=function(e,t,o){new DataView(t,o).setUint32(0,e.length);const{written:i}=st.encodeInto(e,new Uint8Array(t).subarray(o+4));return o+4+i},ht=Object.freeze(new Map([[0,function(e,t){const o=new ArrayBuffer(t+1+(4+e.errorMessage.length));return new DataView(o,t).setUint8(0,e.errorCode),O(e.errorMessage,o,t+1),o}],[1,function(e,t){return new ArrayBuffer(t)}],[10,function(e,t){return new ArrayBuffer(t)}],[11,function(e,t){if(e.success){const o=new ArrayBuffer(t+5),a=new DataView(o,t);return a.setUint8(0,e.success),a.setUint32(1,e.code),o}else console.log("unimplemented")}],[12,function(e,t){const o=new ArrayBuffer(t+5+(4+e.userName.length)),a=new DataView(o,t);return a.setUint32(0,e.code),a.setUint8(4,e.colorIndex),O(e.userName,o,t+5),o}],[13,function(e,t){if(e.success){const o=[];let a=0;for(let n=0;n<e.userList.length;++n){const c=e.userList[n],l=4+4+1+(4+c.userName.length);o.push(l),a+=l}const i=new ArrayBuffer(t+1+4+1+a),s=new DataView(i,t);s.setUint8(0,e.success),s.setUint32(1,e.publicId),s.setUint8(5,e.userList.length);let r=t+1+4+1;for(let n=0;n<e.userList.length;++n){const c=e.userList[n],l=o[n];let u=new DataView(i,r);u.setUint32(0,l),u.setUint32(4,c.publicId),u.setUint8(8,c.colorIndex),r=O(c.userName,i,r+9)}return i}else{const o=new ArrayBuffer(t+2+(4+e.errorMessage.length)),a=new DataView(o,t);return a.setUint8(0,e.success),a.setUint8(1,e.errorCode),O(e.errorMessage,o,t+2),o}}],[14,function(e,t){return new ArrayBuffer(t)}],[15,function(e,t){if(e.success){const o=new ArrayBuffer(t+1);return new DataView(o,t).setUint8(0,e.success),o}else{const o=new ArrayBuffer(t+2+(4+e.errorMessage.length)),a=new DataView(o,t);return a.setUint8(0,e.success),a.setUint8(1,e.errorCode),O(e.errorMessage,o,t+2),o}}],[16,function(e,t){const o=[];let a=0;for(let n=0;n<e.userList.length;++n){const c=e.userList[n],l=4+4+1+(4+c.userName.length);o.push(l),a+=l}const i=new ArrayBuffer(t+1+a);new DataView(i,t).setUint8(0,e.userList.length);let r=t+1;for(let n=0;n<e.userList.length;++n){const c=e.userList[n],l=o[n];let u=new DataView(i,r);u.setUint32(0,l),u.setUint32(4,c.publicId),u.setUint8(8,c.colorIndex),r=O(c.userName,i,r+9)}return i}],[20,function(e,t){const o=new ArrayBuffer(t+8+(4+e.text.length)+(4+e.image.byteLength));let a=new DataView(o,t);const i=new Uint8Array(o);a.setBigInt64(0,BigInt(e.timestamp));let s=O(e.text,o,t+8);return a=new DataView(o,s),a.setUint32(0,e.image.byteLength),i.set(new Uint8Array(e.image),s+4),o}],[21,function(e,t){if(e.success){const o=new ArrayBuffer(t+1);return new DataView(o,t).setUint8(0,e.success),o}else{const o=new ArrayBuffer(t+2+(4+e.errorMessage.length)),a=new DataView(o,t);return a.setUint8(0,e.success),a.setUint8(1,e.errorCode),O(e.errorMessage,o,t+2),o}}],[30,function(e,t){const o=[];let a=0;for(let c=0;c<e.chatMessages.length;++c){const l=e.chatMessages[c],u=4+8+1+(4+l.text.length)+(4+l.userName.length)+(4+l.image.byteLength);o.push(u),a+=u}const i=new ArrayBuffer(t+1+a),s=new DataView(i,t),r=new Uint8Array(i);s.setUint8(0,e.chatMessages.length);let n=t+1;for(let c=0;c<e.chatMessages.length;++c){const l=e.chatMessages[c],u=o[c];let p=new DataView(i,n);p.setUint32(0,u),p.setBigInt64(4,BigInt(l.timestamp)),p.setUint8(12,l.colorIndex),n=O(l.text,i,n+13),n=O(l.userName,i,n),p=new DataView(i,n),p.setUint32(0,l.image.byteLength),r.set(l.image,n+4),n=n+4+l.image.byteLength}return i}]]));class pt{constructor(){v(this,"socket");v(this,"connected");v(this,"onOpenCallback");v(this,"onCloseCallback");v(this,"closeResolve");v(this,"messageResultPromiseWrappers",new Map);v(this,"globalTimeout",5*1e3);v(this,"handleMessageMap",new Map);v(this,"roomCode");v(this,"roomConnected");v(this,"uniqueId");v(this,"userList");v(this,"onReceiveChatMessages");v(this,"onUserListChange");this.handleMessageMap.set(b.get("MSG_TYPE_GENERIC_ERROR"),this.handleGenericError),this.handleMessageMap.set(b.get("MSG_TYPE_NEW_CONNECTION_RESULT"),this.handleNewConnection),this.handleMessageMap.set(b.get("MSG_TYPE_CREATE_ROOM_RESULT"),this.handleCreateRoomResult),this.handleMessageMap.set(b.get("MSG_TYPE_CONNECT_ROOM_RESULT"),this.handleConnectRoomResult),this.handleMessageMap.set(b.get("MSG_TYPE_LEAVE_ROOM_RESULT"),this.handleLeaveRoomResult),this.handleMessageMap.set(b.get("MSG_TYPE_SEND_CHAT_MESSAGE_RESULT"),this.handleSendChatMessageResult),this.handleMessageMap.set(b.get("MSG_TYPE_RECEIVE_CHAT_MESSAGES"),this.handleReceiveChatMessages),this.handleMessageMap.set(b.get("MSG_TYPE_USER_LIST_CHANGE"),this.handleUserListChange),this.connected=!1}onOpen(){this.connected=!0,this.onOpenCallback&&this.onOpenCallback()}startConnection(t,o,a){return new Promise((i,s)=>{this.messageResultPromiseAdd(b.get("MSG_TYPE_NEW_CONNECTION_RESULT"),i,s);const r="wss";this.socket=new WebSocket(r+"://"+t),this.socket.binaryType="arraybuffer",this.socket.onmessage=n=>{this.handleMessage(n)},this.socket.onopen=()=>{this.onOpen()},this.socket.onclose=()=>{this.onClose()},this.onOpenCallback=o,this.onCloseCallback=a})}endConnection(){return new Promise(t=>{this.connected?(this.closeResolve=t,this.socket.close()):t()})}onClose(){this.messageResultPromiseCancel(b.get("MSG_TYPE_NEW_CONNECTION_RESULT"),!0),this.onReceiveChatMessages=void 0,this.onUserListChange=void 0,this.connected=!1,this.roomConnected=void 0,this.roomCode=void 0,this.uniqueId=void 0,this.onCloseCallback&&this.onCloseCallback(),this.onOpenCallback=void 0,this.onCloseCallback=void 0,this.closeResolve&&this.closeResolve()}messageResultPromiseAdd(t,o,a,i){const s=Date.now();if(t==null){const n=new Error("messageResultPromiseAdd: void messageType, ignoring!");n.name="ERROR_MESSAGE_RESULT_REJECTED",a(n)}const r=setTimeout(()=>{if(!this.messageResultPromiseWrappers.has(t))return;if(this.messageResultPromiseWrappers.get(t).timestamp===s){this.messageResultPromiseWrappers.delete(t);const c=new Error(`messageResultPromiseAdd: a promise for ${ie.get(t)} (${t}) has expired, timing out!`);c.name="ERROR_MESSAGE_RESULT_TIMEOUT",a(c)}},this.globalTimeout);this.messageResultPromiseWrappers.set(t,{resolve:o,reject:a,timestamp:s,timeout:r,contextPayload:i,status:"pending"})}messageResultPromiseArrived(t){if(!at.get(t))return null;if(!this.messageResultPromiseWrappers.has(t)){const a=new Error(`messageResultPromiseArrived: no promises for message type: ${ie.get(t)} (${t})`);throw a.name="ERROR_MESSAGE_RESULT_NO_PROMISE",a}const o=this.messageResultPromiseWrappers.get(t);if(clearTimeout(o.timeout),o.status==="arrived"){const a=new Error(`messageResultPromiseArrived: already processed for message type: ${ie.get(t)} (${t})`);throw a.name="ERROR_MESSAGE_RESULT_EXPIRED",a}return o.status="arrived",o}messageResultPromiseCancel(t,o=!1){const a=this.messageResultPromiseWrappers.get(t);if(a!=null&&a.status==="pending"){a.status="canceled",this.messageResultPromiseWrappers.delete(t),clearTimeout(a.timeout);const i=new Error("Connection with chat server failed");i.name="ERROR_GENERIC_ERROR",o&&a.reject(i)}}isAwaitingResult(t){const o=this.messageResultPromiseWrappers.get(t);return o!=null&&o.status==="pending"}sendMessage(t,o){o.type=t,o.uniqueId=this.uniqueId,this.socket.send(dt(o))}handleMessage(t){const o=t.data,{message:a,payloadOffset:i}=rt(o);lt(a,o,i);const s=this.handleMessageMap.get(a.type),r=this.messageResultPromiseArrived(a.type);if(s!=null)r==null?s.call(this,a):s.call(this,r,a);else{const n=new Error("handleMessage: unknown message type: "+a.type);throw n.name="ERROR_MESSAGE_UNIMPLEMENTED_MESSAGE_TYPE",n}}sendCreateRoom(t){return new Promise((o,a)=>{const i={};this.sendMessage(b.get("MSG_TYPE_CREATE_ROOM"),i),this.messageResultPromiseAdd(b.get("MSG_TYPE_CREATE_ROOM_RESULT"),o,a,i)})}sendLeaveRoom(){return new Promise((t,o)=>{const a={};this.sendMessage(b.get("MSG_TYPE_LEAVE_ROOM"),a),this.messageResultPromiseAdd(b.get("MSG_TYPE_LEAVE_ROOM_RESULT"),t,o,a)})}sendConnectRoom(t,o,a){return new Promise((i,s)=>{if(this.isAwaitingResult(b.get("MSG_TYPE_CONNECT_ROOM_RESULT"))){s();return}const r={code:t,userName:o,colorIndex:a},n={code:t};this.sendMessage(b.get("MSG_TYPE_CONNECT_ROOM"),r),this.messageResultPromiseAdd(b.get("MSG_TYPE_CONNECT_ROOM_RESULT"),i,s,r,n)})}sendChatMessage(t){return new Promise((o,a)=>{if(this.isAwaitingResult(b.get("MSG_TYPE_SEND_CHAT_MESSAGE_RESULT"))){a();return}this.sendMessage(b.get("MSG_TYPE_SEND_CHAT_MESSAGE"),t),this.messageResultPromiseAdd(b.get("MSG_TYPE_SEND_CHAT_MESSAGE_RESULT"),o,a,t)})}handleCreateRoomResult(t,o){o.success?t.resolve(o.code):t.reject(this.errorFromMessage(o))}handleLeaveRoomResult(t,o){o.success?(this.roomCode=void 0,this.roomConnected=!1,t.resolve()):t.reject(this.errorFromMessage(o))}handleConnectRoomResult(t,o){o.success?(this.roomCode=t.contextPayload.code,this.roomConnected=!0,this.userList=o.userList,t.resolve(o)):(this.roomCode=void 0,this.roomConnected=!1,t.reject(this.errorFromMessage(o)))}handleSendChatMessageResult(t,o){o.success?t.resolve():t.reject(this.errorFromMessage(o))}handleNewConnection(t,o){this.uniqueId=o.uniqueId,t.resolve()}handleReceiveChatMessages(t){this.onReceiveChatMessages!=null&&this.onReceiveChatMessages(t.chatMessages)}handleUserListChange(t){this.onUserListChange!=null&&(this.onUserListChange(this.userList,t.userList),this.userList=t.userList)}handleGenericError(t){throw this.errorFromMessage(t)}errorFromMessage(t){const o=new Error(t.errorMessage!=null?t.errorMessage:`${_e.get(t.errorCode)} (${t.errorCode})`);return o.name=_e.get(t.errorCode),o}}var ft="/pictoclone/tilemap.png";const Ce=["Dereferencing null pointers","Reticulating splines","Transpiling to Shellscript","Rewriting kernel.org git history","Trapping segfaults","Enabling Blast Processing","Solving over 9000 node packages"],xe=["Bulbasaur","Ivysaur","Venusaur","Charmander","Charmeleon","Charizard","Squirtle","Wartortle","Blastoise","Caterpie","Metapod","Butterfree","Weedle","Kakuna","Beedrill","Pidgey","Pidgeotto","Pidgeot","Rattata","Raticate","Spearow","Fearow","Ekans","Arbok","Pikachu","Raichu","Sandshrew","Sandslash","Nidoran","Nidorina","Nidoqueen","Nidoran","Nidorino","Nidoking","Clefairy","Clefable","Vulpix","Ninetales","Jigglypuff","Wigglytuff","Zubat","Golbat","Oddish","Gloom","Vileplume","Paras","Parasect","Venonat","Venomoth","Diglett","Dugtrio","Meowth","Persian","Psyduck","Golduck","Mankey","Primeape","Growlithe","Arcanine","Poliwag","Poliwhirl","Poliwrath","Abra","Kadabra","Alakazam","Machop","Machoke","Machamp","Bellsprout","Weepinbell","Victreebel","Tentacool","Tentacruel","Geodude","Graveler","Golem","Ponyta","Rapidash","Slowpoke","Slowbro","Magnemite","Magneton","Farfetch'd","Doduo","Dodrio","Seel","Dewgong","Grimer","Muk","Shellder","Cloyster","Gastly","Haunter","Gengar","Onix","Drowzee","Hypno","Krabby","Kingler","Voltorb","Electrode","Exeggcute","Exeggutor","Cubone","Marowak","Hitmonlee","Hitmonchan","Lickitung","Koffing","Weezing","Rhyhorn","Rhydon","Chansey","Tangela","Kangaskhan","Horsea","Seadra","Goldeen","Seaking","Staryu","Starmie","Mr.Mime","Scyther","Jynx","Electabuzz","Magmar","Pinsir","Tauros","Magikarp","Gyarados","Lapras","Ditto","Eevee","Vaporeon","Jolteon","Flareon","Porygon","Omanyte","Omastar","Kabuto","Kabutops","Aerodactyl","Snorlax","Articuno","Zapdos","Moltres","Dratini","Dragonair","Dragonite","Mewtwo","Mew"];var x=(e,t)=>{for(const[o,a]of t)e[o]=a;return e};const gt={name:"App",data:function(){let e=this.isTouchScreen();return{globalValues:{superSample:e?2:3,setSuperSample:this.setSuperSample,autoScale:!0,mobileAssists:e,isTouchScreen:e,isLandscape:se(()=>this.isLandscape),scalingFactor:se(()=>this.getScalingFactor),userColorIndex:Math.round((J.length-1)*Math.random()),userName:"",vibration:120,setVibration:this.setVibration,muted:!1,setVolume:this.setVolume,renderingClass:"rendering-quality",rgbMode:!1,setRgbMode:this.setRgbMode,rgbColorHueDeg:0,audio:void 0,orientation:0,chromeFix:this.getBrowserEngine().match(/(chrome)/)!=null,showGithubLink:!0,chatClient:new pt,chatQueueLimit:64,roomCode:"",serverAddress:"pictoclone.duckdns.org:443"},loading:!0,coldStart:!0,documentWidth:1,documentHeight:1,appViewWidth:1,appViewHeight:1,landscapeBreakpointRatio:18/9,landscapeConstrainRatio:26/9,portraitConstrainRatio:8/9}},created:function(){this.$.root.appContext.config.globalProperties.$global=this.globalValues,this.globalValues.audio=new tt(this.globalValues.vibration,this.globalValues.muted?0:1,this.getBrowserName()==="safari"),this.globalValues.userName=this.getRandomName(),this.$watch(()=>this.globalValues.autoScale,()=>{const e=document.getElementById("app");this.globalValues.autoScale?(e.classList.add("app-overflow"),e.scroll(0,0)):e.classList.remove("app-overflow")},{immediate:!0})},mounted:async function(){requestAnimationFrame(()=>{this.onResize()}),await this.$mapperGenerate({superSample:this.globalValues.superSample,imageSource:ft});try{await this.globalValues.audio.loadSamples()}catch(e){console.error("could not load audio samples:",e)}this.loading=!1,this.coldStart=!1,this.onResizeThrottled=()=>requestAnimationFrame(()=>{this.onResize()}),this.documentObserver=new ResizeObserver(this.onResizeThrottled).observe(document.firstElementChild),this.appViewObserver=new ResizeObserver(this.onResizeThrottled).observe(this.$refs["app-view"])},beforeUnmount:function(){this.documentObserver&&this.documentObserver.unobserve(document.firstElementChild.offsetWidth),this.appViewObserver&&this.appViewObserver.unobserve(this.$refs["app-view"])},computed:{isLandscape:function(){return this.globalValues.orientation<=0?this.documentWidth/this.documentHeight>this.landscapeBreakpointRatio:this.globalValues.orientation===1},colorHueDeg:function(){return Je[this.globalValues.userColorIndex]},getScalingFactor:function(){if(!this.globalValues.autoScale)return 1;const e=this.documentWidth/this.documentHeight;return this.isLandscape?this.documentWidth/this.appViewWidth*Math.min(this.landscapeConstrainRatio/e,1):this.documentWidth/this.appViewWidth*Math.min(this.portraitConstrainRatio/e,1)},getViewStyle:function(){return{height:this.globalValues.autoScale?`calc(${this.documentHeight}px * 1 / var(--global-sf))`:void 0,visibility:this.loading?"hidden":null}},getAppViewStyle:function(){const e=(this.documentWidth-this.appViewWidth*this.getScalingFactor)/2,t=this.globalValues.userColorIndex,o={"--global-cl1":ae[t],"--global-cl2":J[t],"--global-cmain":Se[t],"--global-cfaded":Qe[t],"--global-ss":this.globalValues.superSample,"--global-sf":this.getScalingFactor,"--global-chd":this.colorHueDeg+"deg"};return this.globalValues.autoScale&&(o.marginLeft=e+"px",o.marginRight=e+"px",o.transform=`scale(${this.getScalingFactor})`),o},loadingMessage:function(){return this.loading,Ce[Math.round(Math.random()*(Ce.length-1))]}},methods:{setSuperSample:async function(e){this.loading=!0,this.$nextTick(()=>this.onResize()),await this.$mapperGenerate({superSample:e}),this.globalValues.superSample=e,setTimeout(()=>{this.loading=!1},500)},processRgb:function(e){e-this.rgbAnimationTimestamp>495&&(this.globalValues.rgbColorHueDeg+=120,this.rgbAnimationTimestamp=e),this.globalValues.rgbMode&&(this.rgbAnimationRef=requestAnimationFrame(this.processRgb))},setRgbMode:function(e){e?(this.globalValues.rgbMode=!0,this.rgbAnimationTimestamp=0,this.rgbAnimationRef=requestAnimationFrame(this.processRgb)):(this.globalValues.rgbColorHueDeg=0,this.globalValues.rgbMode=!1,window.cancelAnimationFrame(this.rgbAnimationRef),this.rgbAnimationRef=void 0)},setVolume:function(e){this.globalValues.audio.setVolume(e),this.globalValues.muted=e<=0},setVibration:function(e){this.globalValues.audio.setVibrationStrength(e),this.globalValues.vibration=e},onResize:function(){this.documentWidth=document.firstElementChild.offsetWidth,this.documentHeight=document.firstElementChild.offsetHeight,this.$refs["app-view"]&&(this.appViewWidth=this.$refs["app-view"].offsetWidth,this.appViewHeight=this.$refs["app-view"].offsetHeight)},beforeEnterTransition:function(){this.landscapeBreakpointRatio=this.$route.meta.landscapeBreakpointRatio,this.landscapeConstrainRatio=this.$route.meta.landscapeConstrainRatio,this.portraitConstrainRatio=this.$route.meta.portraitConstrainRatio},getRandomName:function(){return xe[Math.round(Math.random()*(xe.length-1))]},getBrowserName:function(){let e=navigator.userAgent;return/Safari\/[0-9.-]+/.test(e)&&!/Chrome\/[0-9.-]+/.test(e)&&!/Edge\/[0-9.-]+/.test(e)&&!/Chromium\/[0-9.-]+/.test(e)?"safari":"other"},getBrowserEngine:function(){let e=navigator.userAgent;return/Gecko\/[0-9.-]+/.test(e)?"gecko":/Chrome\/[0-9.-]+/.test(e)?"chrome":/AppleWebKit\/[0-9.-]+/.test(e)?"webkit":"other"},isTouchScreen:function(){return"maxTouchPoints"in navigator||"msMaxTouchPoints"in navigator?navigator.maxTouchPoints>0:!1}}},mt={key:0,class:"loading"},bt=h("div",{class:"loading-circle"},null,-1);function yt(e,t,o,a,i,s){const r=k("router-view");return d(),f(T,null,[e.loading?(d(),f("div",mt,[bt,$(" "+E(s.loadingMessage)+"... ",1)])):B("",!0),h("div",{class:_(["app-view",this.globalValues.renderingClass,this.isLandscape?"landscape":"portrait",!this.globalValues.autoScale&&"no-scale",this.globalValues.mobileAssists&&"mobile-assists"]),style:g(s.getAppViewStyle),ref:"app-view"},[w(r,null,{default:S(({Component:n})=>[w(Fe,{name:"fade",mode:"out-in",onBeforeEnter:s.beforeEnterTransition},{default:S(()=>[e.coldStart?B("",!0):(d(),N(pe(n),{key:0,style:g(s.getViewStyle)},null,8,["style"]))]),_:2},1032,["onBeforeEnter"])]),_:1}),h("div",{id:"modal-teleport-target",class:"modal",style:g(s.getViewStyle)},null,4)],6)],64)}var kt=x(gt,[["render",yt]]);const wt="modulepreload",Ee={},vt="/pictoclone/",St=function(t,o){return!o||o.length===0?t():Promise.all(o.map(a=>{if(a=`${vt}${a}`,a in Ee)return;Ee[a]=!0;const i=a.endsWith(".css"),s=i?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${s}`))return;const r=document.createElement("link");if(r.rel=i?"stylesheet":wt,i||(r.as="script",r.crossOrigin=""),r.href=a,document.head.appendChild(r),i)return new Promise((n,c)=>{r.addEventListener("load",n),r.addEventListener("error",c)})})).then(()=>t())},Te=[{name:"corner",variants:["tl","tr","bl","br"],notchable:!0,positionX:{tl:"top",tr:"top",bl:"bottom",br:"bottom"},positionY:{tl:"left",tr:"right",bl:"left",br:"right"},sizeX:{tl:!1,tr:!1,bl:!1,br:!1},sizeY:{tl:!1,tr:!1,bl:!1,br:!1}},{name:"straight",variants:["t","r","b","l"],notchable:!1,positionX:{t:"top",r:"top",b:"bottom",l:"top"},positionY:{t:"left",r:"right",b:"left",l:"left"},sizeX:{t:!0,r:!1,b:!0,l:!1},sizeY:{t:!1,r:!0,b:!1,l:!0}},{name:"center",variants:[""],notchable:!1,positionX:{"":"top"},positionY:{"":"left"},sizeX:{"":!0},sizeY:{"":!0}}],U=[{x:0,y:0,w:4,h:4,alias:"corner1-tl",backgroundRepeat:"no-repeat",backgroundPosition:"top left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:4,y:0,w:4,h:4,alias:"corner1-tr",backgroundRepeat:"no-repeat",backgroundPosition:"top right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:8,y:0,w:4,h:4,alias:"corner1-bl",backgroundRepeat:"no-repeat",backgroundPosition:"bottom left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:12,y:0,w:4,h:4,alias:"corner1-br",backgroundRepeat:"no-repeat",backgroundPosition:"bottom right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:16,y:0,w:4,h:4,alias:"corner2-tl",backgroundRepeat:"no-repeat",backgroundPosition:"top left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:20,y:0,w:4,h:4,alias:"corner2-tr",backgroundRepeat:"no-repeat",backgroundPosition:"top right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:24,y:0,w:4,h:4,alias:"corner2-bl",backgroundRepeat:"no-repeat",backgroundPosition:"bottom left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:28,y:0,w:4,h:4,alias:"corner2-br",backgroundRepeat:"no-repeat",backgroundPosition:"bottom right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:32,y:0,w:4,h:4,alias:"straight-t",backgroundRepeat:"repeat-x",backgroundPosition:"top",top:0,left:4,bottom:0,right:4,offsetX:0,offsetY:4},{x:36,y:0,w:4,h:4,alias:"straight-r",backgroundRepeat:"repeat-y",backgroundPosition:"right",top:4,left:0,bottom:4,right:0,offsetX:4,offsetY:0},{x:40,y:0,w:4,h:4,alias:"straight-b",backgroundRepeat:"repeat-x",backgroundPosition:"bottom",top:0,left:4,bottom:0,right:4,offsetX:0,offsetY:4},{x:44,y:0,w:4,h:4,alias:"straight-l",backgroundRepeat:"repeat-y",backgroundPosition:"left",top:4,left:0,bottom:4,right:0,offsetX:4,offsetY:0},{x:48,y:0,w:4,h:4,alias:"center",backgroundRepeat:"repeat",backgroundPosition:null,top:0,left:4,bottom:0,right:4,offsetX:4,offsetY:4}],_t=[{x:0,y:0,w:1,h:1,alias:"1px",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0,noSuperSample:!0},{x:1,y:0,w:2,h:2,alias:"2px",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0,noSuperSample:!0},{x:10,y:0,w:5,h:5,alias:"5px",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0,noSuperSample:!0}],Z=[{x:0,y:0,w:2,h:2,alias:"corner1-tl",backgroundRepeat:"no-repeat",backgroundPosition:"top left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:2,y:0,w:2,h:2,alias:"corner1-tr",backgroundRepeat:"no-repeat",backgroundPosition:"top right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:4,y:0,w:2,h:2,alias:"corner1-bl",backgroundRepeat:"no-repeat",backgroundPosition:"bottom left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:6,y:0,w:2,h:2,alias:"corner1-br",backgroundRepeat:"no-repeat",backgroundPosition:"bottom right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:8,y:0,w:2,h:2,alias:"corner2-tl",backgroundRepeat:"no-repeat",backgroundPosition:"top left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:8,y:0,w:2,h:2,alias:"corner2-tr",backgroundRepeat:"no-repeat",backgroundPosition:"top right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:8,y:0,w:2,h:2,alias:"corner2-bl",backgroundRepeat:"no-repeat",backgroundPosition:"bottom left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:8,y:0,w:2,h:2,alias:"corner2-br",backgroundRepeat:"no-repeat",backgroundPosition:"bottom right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:8,y:0,w:2,h:2,alias:"straight-t",backgroundRepeat:"repeat-x",backgroundPosition:"top",top:0,left:2,bottom:0,right:2,offsetX:0,offsetY:2},{x:8,y:0,w:2,h:2,alias:"straight-r",backgroundRepeat:"repeat-y",backgroundPosition:"right",top:2,left:0,bottom:2,right:0,offsetX:2,offsetY:0},{x:8,y:0,w:2,h:2,alias:"straight-b",backgroundRepeat:"repeat-x",backgroundPosition:"bottom",top:0,left:2,bottom:0,right:2,offsetX:0,offsetY:2},{x:8,y:0,w:2,h:2,alias:"straight-l",backgroundRepeat:"repeat-y",backgroundPosition:"left",top:2,left:0,bottom:2,right:0,offsetX:2,offsetY:0},{x:8,y:0,w:2,h:2,alias:"center",backgroundRepeat:"repeat",backgroundPosition:null,top:0,left:2,bottom:0,right:2,offsetX:2,offsetY:2}],Me=[{x:0,y:0,w:25,h:17,alias:"copy",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:25,y:0,w:27,h:26,alias:"send",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:52,y:0,w:25,h:18,alias:"clear",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:0,y:26,w:12,h:12,alias:"symbols2",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:12,y:26,w:12,h:12,alias:"symbols1",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:24,y:26,w:12,h:12,alias:"kana",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:36,y:26,w:12,h:12,alias:"accents",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:48,y:26,w:12,h:12,alias:"romaji",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:60,y:26,w:12,h:12,alias:"brush-small",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:72,y:26,w:12,h:12,alias:"brush-big",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:84,y:26,w:12,h:12,alias:"brush-bigger",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:0,y:38,w:12,h:11,alias:"brush",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:12,y:38,w:12,h:11,alias:"eraser",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:24,y:38,w:14,h:14,alias:"arrow-down",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:38,y:38,w:14,h:14,alias:"arrow-up",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:52,y:38,w:12,h:11,alias:"bucket",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0}],Pe=[{x:0,y:0,w:23,h:13,alias:"backspace",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:23,y:0,w:32,h:13,alias:"enter",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:0,y:13,w:15,h:13,alias:"caps",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:15,y:13,w:23,h:13,alias:"shift",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:38,y:13,w:19,h:12,alias:"space",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:0,y:26,w:16,h:13,alias:"small-backspace",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:15,y:26,w:18,h:11,alias:"small-space",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:66,y:0,w:18,h:29,alias:"small-enter",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:0,y:39,w:15,h:11,alias:"hiragana",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:15,y:39,w:15,h:12,alias:"katakana",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:30,y:39,w:15,h:12,alias:"tenten",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:45,y:39,w:15,h:12,alias:"maru",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0},{x:60,y:39,w:15,h:9,alias:"komoji",backgroundRepeat:"no-repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0}],ne=[{x:0,y:0,w:2,h:2,alias:"corner1-tl",backgroundRepeat:"no-repeat",backgroundPosition:"top left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:2,y:0,w:2,h:2,alias:"corner1-tr",backgroundRepeat:"no-repeat",backgroundPosition:"top right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:4,y:0,w:2,h:2,alias:"corner1-bl",backgroundRepeat:"no-repeat",backgroundPosition:"bottom left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:6,y:0,w:2,h:2,alias:"corner1-br",backgroundRepeat:"no-repeat",backgroundPosition:"bottom right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:0,y:0,w:2,h:2,alias:"corner2-tl",backgroundRepeat:"no-repeat",backgroundPosition:"top left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:2,y:0,w:2,h:2,alias:"corner2-tr",backgroundRepeat:"no-repeat",backgroundPosition:"top right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:4,y:0,w:2,h:2,alias:"corner2-bl",backgroundRepeat:"no-repeat",backgroundPosition:"bottom left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:6,y:0,w:2,h:2,alias:"corner2-br",backgroundRepeat:"no-repeat",backgroundPosition:"bottom right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:8,y:0,w:2,h:2,alias:"straight-t",backgroundRepeat:"repeat-x",backgroundPosition:"top",top:0,left:2,bottom:0,right:2,offsetX:0,offsetY:2},{x:10,y:0,w:2,h:2,alias:"straight-r",backgroundRepeat:"repeat-y",backgroundPosition:"right",top:2,left:0,bottom:2,right:0,offsetX:2,offsetY:0},{x:12,y:0,w:2,h:2,alias:"straight-b",backgroundRepeat:"repeat-x",backgroundPosition:"bottom",top:0,left:2,bottom:0,right:2,offsetX:0,offsetY:2},{x:14,y:0,w:2,h:2,alias:"straight-l",backgroundRepeat:"repeat-y",backgroundPosition:"left",top:2,left:0,bottom:2,right:0,offsetX:2,offsetY:0},{x:16,y:0,w:2,h:2,alias:"center",backgroundRepeat:"repeat",backgroundPosition:null,top:0,left:2,bottom:0,right:2,offsetX:2,offsetY:2}],Ae=[{x:0,y:0,w:3,h:3,alias:"corner1-tl",backgroundRepeat:"no-repeat",backgroundPosition:"top left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:3,y:0,w:3,h:3,alias:"corner1-tr",backgroundRepeat:"no-repeat",backgroundPosition:"top right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:6,y:0,w:3,h:3,alias:"corner1-bl",backgroundRepeat:"no-repeat",backgroundPosition:"bottom left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:9,y:0,w:3,h:3,alias:"corner1-br",backgroundRepeat:"no-repeat",backgroundPosition:"bottom right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:0,y:0,w:3,h:3,alias:"corner2-tl",backgroundRepeat:"no-repeat",backgroundPosition:"top left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:3,y:0,w:3,h:3,alias:"corner2-tr",backgroundRepeat:"no-repeat",backgroundPosition:"top right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:6,y:0,w:3,h:3,alias:"corner2-bl",backgroundRepeat:"no-repeat",backgroundPosition:"bottom left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:9,y:0,w:3,h:3,alias:"corner2-br",backgroundRepeat:"no-repeat",backgroundPosition:"bottom right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:12,y:0,w:3,h:3,alias:"straight-t",backgroundRepeat:"repeat-x",backgroundPosition:"top",top:0,left:3,bottom:0,right:3,offsetX:0,offsetY:3},{x:15,y:0,w:3,h:3,alias:"straight-r",backgroundRepeat:"repeat-y",backgroundPosition:"right",top:3,left:0,bottom:3,right:0,offsetX:3,offsetY:0},{x:18,y:0,w:3,h:3,alias:"straight-b",backgroundRepeat:"repeat-x",backgroundPosition:"bottom",top:0,left:3,bottom:0,right:3,offsetX:0,offsetY:3},{x:21,y:0,w:3,h:3,alias:"straight-l",backgroundRepeat:"repeat-y",backgroundPosition:"left",top:3,left:0,bottom:3,right:0,offsetX:3,offsetY:0},{x:0,y:6,w:1,h:12,alias:"center",backgroundRepeat:"repeat",backgroundPosition:null,top:0,left:0,bottom:0,right:0,offsetX:3,offsetY:3}],Rt=[{x:0,y:0,w:7,h:7,alias:"corner1-tl",backgroundRepeat:"no-repeat",backgroundPosition:"top left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:7,y:0,w:7,h:7,alias:"corner1-tr",backgroundRepeat:"no-repeat",backgroundPosition:"top right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:14,y:0,w:7,h:7,alias:"corner1-bl",backgroundRepeat:"no-repeat",backgroundPosition:"bottom left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:21,y:0,w:7,h:7,alias:"corner1-br",backgroundRepeat:"no-repeat",backgroundPosition:"bottom right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:0,y:0,w:7,h:7,alias:"corner2-tl",backgroundRepeat:"no-repeat",backgroundPosition:"top left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:7,y:0,w:7,h:7,alias:"corner2-tr",backgroundRepeat:"no-repeat",backgroundPosition:"top right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:14,y:0,w:7,h:7,alias:"corner2-bl",backgroundRepeat:"no-repeat",backgroundPosition:"bottom left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:21,y:0,w:7,h:7,alias:"corner2-br",backgroundRepeat:"no-repeat",backgroundPosition:"bottom right",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:28,y:0,w:7,h:5,alias:"straight-t",backgroundRepeat:"repeat-x",backgroundPosition:"top",top:0,left:7,bottom:0,right:7,offsetX:0,offsetY:7},{x:35,y:0,w:7,h:6,alias:"straight-r",backgroundRepeat:"repeat-y",backgroundPosition:"right",top:7,left:0,bottom:7,right:0,offsetX:7,offsetY:0},{x:42,y:0,w:7,h:7,alias:"straight-b",backgroundRepeat:"repeat-x",backgroundPosition:"bottom",top:0,left:7,bottom:0,right:7,offsetX:0,offsetY:7},{x:49,y:0,w:7,h:6,alias:"straight-l",backgroundRepeat:"repeat-y",backgroundPosition:"left",top:7,left:0,bottom:7,right:0,offsetX:7,offsetY:0},{x:56,y:0,w:6,h:6,alias:"center",backgroundRepeat:"repeat",backgroundPosition:"top",top:0,left:7,bottom:0,right:7,offsetX:6,offsetY:6}],Ct=[{x:0,y:0,w:16,h:16,alias:"blank",backgroundRepeat:"no-repeat",backgroundPosition:"top left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:16,y:0,w:16,h:16,alias:"input-pre-border-left",backgroundRepeat:"no-repeat",backgroundPosition:"top left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:32,y:0,w:16,h:16,alias:"input-border-left",backgroundRepeat:"no-repeat",backgroundPosition:"top left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:48,y:0,w:16,h:16,alias:"input",backgroundRepeat:"no-repeat",backgroundPosition:"top left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:64,y:0,w:16,h:16,alias:"input-post-border-right",backgroundRepeat:"no-repeat",backgroundPosition:"top left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:80,y:0,w:16,h:16,alias:"input-caret",backgroundRepeat:"no-repeat",backgroundPosition:"top left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0}],xt=[{x:0,y:0,w:8,h:16,alias:"bottom",backgroundRepeat:"no-repeat",backgroundPosition:"top left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0},{x:8,y:0,w:8,h:16,alias:"top",backgroundRepeat:"no-repeat",backgroundPosition:"top left",top:0,left:0,bottom:0,right:0,offsetX:0,offsetY:0}],Be=[{groupName:"main-button",x:0,y:0,map:m.exports.cloneDeep(U)},{groupName:"main-highlight",x:0,y:4,map:m.exports.cloneDeep(U)},{groupName:"main-inverted",x:0,y:8,map:m.exports.cloneDeep(U)},{groupName:"main-color-fill",x:0,y:12,colorVariations:!0,map:m.exports.cloneDeep(U)},{groupName:"main-background",x:0,y:16,map:m.exports.cloneDeep(U)},{groupName:"main-foreground",x:0,y:20,map:m.exports.cloneDeep(U)},{groupName:"main-drawing-area",x:0,y:24,colorVariations:!0,map:m.exports.cloneDeep(U)},{groupName:"main-color-background",x:0,y:28,colorVariations:!0,map:m.exports.cloneDeep(U)},{groupName:"brush-normal",x:52,y:0,map:m.exports.cloneDeep(_t)},{groupName:"small-button",x:0,y:32,map:m.exports.cloneDeep(Z)},{groupName:"small-button-highlight",x:10,y:32,colorVariations:!0,map:m.exports.cloneDeep(Z)},{groupName:"keyboard-normal",x:20,y:32,map:m.exports.cloneDeep(Z)},{groupName:"keyboard-special",x:30,y:32,map:m.exports.cloneDeep(Z)},{groupName:"keyboard-highlight",x:40,y:32,map:m.exports.cloneDeep(Z)},{groupName:"icon-normal",x:0,y:34,map:m.exports.cloneDeep(Me)},{groupName:"icon-color-fill",x:0,y:86,colorVariations:!0,map:m.exports.cloneDeep(Me)},{groupName:"icon-keyboard-normal",x:0,y:138,map:m.exports.cloneDeep(Pe)},{groupName:"icon-keyboard-highlight",x:0,y:190,colorVariations:!0,map:m.exports.cloneDeep(Pe)},{groupName:"thin-frame",x:4,y:247,map:m.exports.cloneDeep(ne)},{groupName:"beveled-button",x:4,y:249,map:m.exports.cloneDeep(ne)},{groupName:"beveled-button-highlight",x:4,y:251,map:m.exports.cloneDeep(ne)},{groupName:"large-beveled-button",x:0,y:241,map:m.exports.cloneDeep(Ae)},{groupName:"large-beveled-button-inverted",x:0,y:244,map:m.exports.cloneDeep(Ae).map(e=>(e.alias==="center"&&(e.x=2,e.y=3),e))},{groupName:"modal-dialog",x:24,y:241,map:m.exports.cloneDeep(Rt)},{groupName:"grid-background",x:0,y:259,map:m.exports.cloneDeep(Ct)},{groupName:"deco-band",x:0,y:276,map:m.exports.cloneDeep(xt)}],te=2;const Et={name:"WPlate",props:{padding:{type:Number,required:!1,default:null},noBorders:{type:Boolean,required:!1,default:!1},notch:{type:Array,required:!1,default:null},tileName:{type:String,required:!1,default:"main-button"},stripeMode:{type:Number,required:!1,default:null},colorIndex:{type:Number,required:!1,default:null},tileMode:{type:Boolean,required:!1,default:!1}},data:function(){return{over:!1,click:!1}},computed:{internalPadding:function(){return this.padding==null?this.$global.superSample*4:this.$global.superSample*this.padding},plateStyle:function(){return{padding:this.internalPadding+"px"}},getColorIndex:function(){return this.colorIndex!=null?this.colorIndex:this.$global.userColorIndex},scaledPlateStyle:function(){const e=this.$global.superSample,t=this.$global.chromeFix&&this.$global.autoScale?e<2?0:.4:0,o={};if(this.noBorders){const a=this.tileName+"-center",i=this.$tileMap(a,this.getColorIndex);if(i==null)throw new Error("Could not find tile: "+a);o.backgroundImage="url("+i.url+")",o.backgroundSize="100% 100%"}else for(let a=0;a<Te.length;++a){const i=Te[a];for(let s=0;s<i.variants.length;++s){const r=i.variants[s];let n="";i.notchable&&this.notch?r==="tl"?n=this.notch[0]?"1":"2":r==="tr"?n=this.notch[1]?"1":"2":r==="br"?n=this.notch[2]?"1":"2":r==="bl"?n=this.notch[3]?"1":"2":n="2":i.notchable&&(n="2");const c=this.tileName+"-"+i.name+n+(r&&r!==""?"-"+r:""),l=this.$tileMap(c,this.getColorIndex);if(l==null)throw new Error("Could not find tile: "+c);const u={backgroundImage:"url("+l.url+")",backgroundRepeat:"no-repeat",backgroundPosition:`
                ${i.positionX[r]} ${l.offsetX}px
                ${i.positionY[r]} ${l.offsetY}px`,backgroundSize:(i.sizeX[r]?`calc(100% - ${l.offsetY*2-t}px)`:`${l.w+t}px`)+" "+(i.sizeY[r]?`calc(100% - ${l.offsetX*2-t}px)`:`${l.h+t*2}px`)};this.mergeSlice(o,u)}}return o},tiledCornerSlices:function(){this.$global.superSample;const e={};return this.mergeSlice(e,this.getSlice(this.tileName+"-corner"+(this.notch&&this.notch[0]?"1":"2")+"-tl")),this.mergeSlice(e,this.getSlice(this.tileName+"-corner"+(this.notch&&this.notch[1]?"1":"2")+"-tr")),this.mergeSlice(e,this.getSlice(this.tileName+"-corner"+(this.notch&&this.notch[2]?"1":"2")+"-br")),this.mergeSlice(e,this.getSlice(this.tileName+"-corner"+(this.notch&&this.notch[3]?"1":"2")+"-bl")),e.left=e.left+"px",e.right=e.right+"px",e.top=e.top+"px",e.bottom=e.bottom+"px",e},tiledStraightLRSlices:function(){this.$global.superSample;const e={};return this.stripeMode===1?(e.backgroundImage="linear-gradient(0deg, #bababa calc(var(--global-ss) * 1px), transparent calc(var(--global-ss) * 1px), transparent calc(var(--global-ss) * 4px), #bababa calc(var(--global-ss) * 4px), #bababa calc(var(--global-ss) * 5px), transparent calc(var(--global-ss) * 5px), transparent calc(var(--global-ss) * 8px))",e.backgroundPosition="bottom",e.backgroundRepeat="repeat-y",e.backgroundSize="calc(100% - calc(var(--global-ss) * 2px)) calc(var(--global-ss) * 8px), auto, auto"):this.stripeMode===2&&(e.backgroundImage="linear-gradient(0deg, var(--global-cl1) calc(var(--global-ss) * 1px), transparent calc(var(--global-ss) * 1px), transparent calc(var(--global-ss) * 16px), var(--global-cl1) calc(var(--global-ss) * 16px), var(--global-cl1) calc(var(--global-ss) * 17px), transparent calc(var(--global-ss) * 17px), transparent calc(var(--global-ss) * 32px))",e.backgroundPosition="top",e.backgroundRepeat="repeat-y",e.backgroundSize="calc(100% - calc(var(--global-ss) * 6px)) calc(var(--global-ss) * 32px - 1px), auto, auto"),this.noBorders||(this.mergeSlice(e,this.getSlice(this.tileName+"-straight-l")),this.mergeSlice(e,this.getSlice(this.tileName+"-straight-r")),e.left=e.left+"px",e.right=e.right+"px",e.top=e.top+"px",e.bottom=e.bottom+"px"),e},tiledStraightTBSlices:function(){const e=this.$global.superSample,t=this.$global.chromeFix&&this.$global.autoScale?e<2?0:.4:0,o={};if(this.noBorders){const a=this.tileName+"-center",i=this.$tileMap(a,this.getColorIndex);if(i==null)throw new Error("Could not find tile: "+a);o.backgroundImage="url("+i.url+")"}else this.mergeSlice(o,this.getSlice(this.tileName+"-straight-t")),this.mergeSlice(o,this.getSlice(this.tileName+"-straight-b")),this.mergeSlice(o,this.getSlice(this.tileName+"-center")),o.left=o.left-t+"px",o.right=o.right-t+"px",o.top=o.top+"px",o.bottom=o.bottom+"px";return o}},methods:{getSlice:function(e){const t={},o=this.$tileMap(e,this.getColorIndex);return o==null?null:(t.backgroundImage="url("+o.url+")",t.backgroundRepeat=o.backgroundRepeat,t.backgroundPosition=o.backgroundPosition,t.top=o.top,t.left=o.left,t.bottom=o.bottom,t.right=o.right,t)},mergeSlice:function(e,t){const o=["backgroundImage","backgroundPosition","backgroundRepeat","backgroundSize"];for(let a=0;a<o.length;++a){const i=o[a];e[i]&&t[i]?e[i]=e[i]+" , "+t[i]:t[i]&&(e[i]=t[i])}e.top=t.top,e.left=t.left,e.bottom=t.bottom,e.right=t.right}}};function Tt(e,t,o,a,i,s){return d(),f("div",{class:"plate",style:g(s.plateStyle)},[o.tileMode?(d(),f(T,{key:1},[h("div",{class:_(["plate-slice"]),style:g(s.tiledStraightTBSlices)},null,4),h("div",{class:_(["plate-slice"]),style:g(s.tiledStraightLRSlices)},null,4),o.noBorders?B("",!0):(d(),f("div",{key:0,class:_(["plate-slice"]),style:g(s.tiledCornerSlices)},null,4))],64)):(d(),f(T,{key:0},[h("div",{class:"plate-slice",style:g(s.scaledPlateStyle)},null,4),o.stripeMode?(d(),f("div",{key:0,class:_(["plate-slice","scaled-mode-stripe-"+o.stripeMode])},null,2)):B("",!0)],64)),L(e.$slots,"default",{},void 0,!0)],4)}var j=x(Et,[["render",Tt],["__scopeId","data-v-c25ddf9a"]]);const Mt={name:"WButton",components:{WPlate:j},props:{icon:{type:String,required:!1,default:null},iconMargin:{type:Array,required:!1,default:null},iconPrefixNormal:{type:String,required:!1,default:"icon-normal"},iconPrefixHighlight:{type:String,required:!1,default:"icon-color-fill"},normalClass:{type:String,required:!1,default:""},activeClass:{type:String,required:!1,default:""},toggled:{type:Boolean,required:!1,default:!1},disabled:{type:Boolean,required:!1,default:!1},plateNotch:{type:Array,required:!1,default:null},platePadding:{type:Number,required:!1,default:null},normalTile:{type:String,required:!1,default:null},activeTile:{type:String,required:!1,default:null},expandPlate:{type:Boolean,required:!1,default:!1},audioFeedback:{type:Boolean,required:!1,default:!1}},data:function(){return{clicking:!1}},created:function(){},computed:{iconBase:function(){const e={},t=this.$global.superSample;let o;if(this.clicking||this.toggled?o=this.$tileMap(this.iconPrefixHighlight+"-"+this.icon,this.$global.userColorIndex):o=this.$tileMap(this.iconPrefixNormal+"-"+this.icon),this.iconMargin){const a=this.iconMargin;e.width=`${o.w+a[1]*2*t}px`,e.height=`${o.h+a[0]*2*t}px`}else e.width=`${o.w}px`,e.height=`${o.h}px`;return e.backgroundImage=`url(${o.url})`,e.backgroundImage=`url(${o.url})`,e},buttonStyle:function(){let e;return this.icon&&!this.normalTile?e=this.iconBase:e={},this.normalTile&&(e.backgroundColor="unset"),this.disabled&&(e.filter="contrast(0.3) brightness(1.4)"),e}},methods:{onPointerDown:function(e){this.disabled||e.buttons&1&&(this.clicking=!0)},onPointerUp:function(){this.audioFeedback&&this.$global.audio.playProgram("pc-click"),setTimeout(()=>{this.clicking=!1},150)},onPointerLeave:function(){setTimeout(()=>{this.clicking=!1},150)},onPointerCancel:function(){this.clicking=!1}}},Pt=["disabled"];function At(e,t,o,a,i,s){const r=k("w-plate");return d(),f("button",{style:g(s.buttonStyle),disabled:o.disabled,class:_(["button",e.clicking||o.toggled?o.activeClass:o.normalClass]),onPointerdown:t[0]||(t[0]=(...n)=>s.onPointerDown&&s.onPointerDown(...n)),onPointerup:t[1]||(t[1]=(...n)=>s.onPointerUp&&s.onPointerUp(...n)),onPointercancel:t[2]||(t[2]=(...n)=>s.onPointerCancel&&s.onPointerCancel(...n)),onPointerleave:t[3]||(t[3]=(...n)=>s.onPointerLeave&&s.onPointerLeave(...n))},[o.normalTile?(d(),N(r,{key:0,notch:o.plateNotch,"tile-name":o.toggled||e.clicking?o.activeTile:o.normalTile,padding:o.platePadding,class:_(["button-plate",o.expandPlate&&"plate-expand"])},{default:S(()=>[L(e.$slots,"default",{},void 0,!0),o.icon?(d(),f("div",{key:0,class:"plate-icon",style:g(s.iconBase)},null,4)):B("",!0)]),_:3},8,["notch","tile-name","padding","class"])):B("",!0),o.normalTile?B("",!0):L(e.$slots,"default",{key:1},void 0,!0)],46,Pt)}var W=x(Mt,[["render",At],["__scopeId","data-v-d13e1282"]]);const Bt={romaji:{sections:[{class:"row1",keyClass:"key-14px",keys:["1","2","3","4","5","6","7","8","9","0","-","="],shiftKeys:["!","@","#","$","%","^","&","*","(",")","_","+"]},{class:"row2",keyClass:"key-15px",keys:["q","w","e","r","t","y","u","i","o","p","backspace"],shiftKeys:["Q","W","E","R","T","Y","U","I","O","P","backspace"]},{class:"row3",keyClass:"key-15px",keys:["caps","a","s","d","f","g","h","j","k","l","enter"],shiftKeys:["caps","A","S","D","F","G","H","J","K","L","enter"]},{class:"row4",keyClass:"key-15px",keys:["shift","z","x","c","v","b","n","m",",",".","/"],shiftKeys:["shift","Z","X","C","V","B","N","M","<",">","?"]},{class:"row5",keyClass:"key-14px",keys:[";","'","space","[","]"],shiftKeys:[":",'"',"space","{","}"]}]},accents:{sections:[{class:"row1",keyClass:"key-15px-slim",keys:["\xE0","\xE1","\xE2","\xE4","\xE3","\xC0","\xC1","\xC2","\xC4","\xE7","\xF1"]},{class:"row2",keyClass:"key-15px-slim",keys:["\xEC","\xED","\xEE","\xEF","\xA1","\xCC","\xCD","\xCE","\xCF","\xC7","\xD1","small-backspace"]},{class:"row3",keyClass:"key-15px-slim",keys:["\xF9","\xFA","\xFB","\xFC","\xBF","\xD9","\xDA","\xDB","\xDC","\u0153","\xE6","small-enter"]},{class:"row4",keyClass:"key-15px-slim",keys:["\xE8","\xE9","\xEA","\xEB","\xDF","\xC8","\xC9","\xCA","\xCB","\u0152","\xC6"]},{class:"row5",keyClass:"key-15px-slim",keys:["\xF2","\xF3","\xF4","\xF6","\xF5","\xD2","\xD3","\xD4","\xD6","\u024D","\xB6","small-space"]}]},kana:{sections:[{class:"row1",keyClass:"key-15px-slim",keys:["hiragana","\u3042","\u304B","\u3055","\u305F","\u306A","\u306F","\u307E","\u3084","\u3089","\u308F","\u30FC"],shiftKeys:["hiragana","\u30A2","\u30AB","\u30B5","\u30BF","\u30CA","\u30CF","\u30DE","\u30E4","\u30E9","\u30EF","\u30FC"]},{class:"row2",keyClass:"key-15px-slim",keys:["katakana","\u3044","\u304D","\u3057","\u3061","\u306B","\u3072","\u307F","\u3086","\u308A","\u3092","small-backspace"],shiftKeys:["katakana","\u30A4","\u30AD","\u30B7","\u30C1","\u30CB","\u30D2","\u30DF","\u30E6","\u30EA","\u30F2","small-backspace"]},{class:"row3",keyClass:"key-15px-slim",keys:["tenten","\u3046","\u304F","\u3059","\u3064","\u306C","\u3075","\u3080","\u3088","\u308B","\u3093","small-enter"],shiftKeys:["tenten","\u30A6","\u30AF","\u30B9","\u30C4","\u30CC","\u30D5","\u30E0","\u30E8","\u30EB","\u30F3","small-enter"]},{class:"row4",keyClass:"key-15px-slim",keys:["maru","\u3048","\u3051","\u305B","\u3066","\u306D","\u3078","\u3081","\uFF01","\u308C","\u3001"],shiftKeys:["maru","\u30A8","\u30B1","\u30BB","\u30C6","\u30CD","\u30D8","\u30E1","\uFF01","\u30EC","\u3001"]},{class:"row5",keyClass:"key-15px-slim",keys:["komoji","\u304A","\u3053","\u305D","\u3068","\u306E","\u307B","\u3082","\uFF1F","\u308D","\u3002","small-space"],shiftKeys:["komoji","\u30AA","\u30B3","\u30BD","\u30C8","\u30CE","\u30CF","\u30E2","\uFF1F","\u30ED","\u3002","small-space"]}]},symbols1:{sections:[{class:"row1",keyClass:"key-15px-slim",keys:["!","?","&",'"',"'","~",":",";","@","\u02DC","_","\u20AC"]},{class:"row2",keyClass:"key-15px-slim",keys:["+","-","*","/","\xD7","\xF7","=","\u2192","\u2190","\u2191","\u2193","small-backspace"]},{class:"row3",keyClass:"key-15px-slim",keys:["\u300C","\u300D","\u201C","\u201D","(",")","<",">","{","}","\u2022","small-enter"]},{class:"row4",keyClass:"key-15px-slim",keys:["%","\u2668","\u3012","#","\u266D","\u266A","\xB1","$","\xA2","\xA3","\\"]},{class:"row5",keyClass:"key-15px-slim",keys:["^","\u309C","|","\uFF0F","\uFF3C","\u221E","\u2234","\u2026","\u2122","\xA9","\xAE","small-space"]}]},symbols2:{sections:[{class:"row1",keyClass:"key-15px-slim",keys:["n1","2","3","4","5","6","7","8","9","0","=","\u03C0"]},{class:"row2",keyClass:"key-15px-slim",keys:["\u2638","\u2639","\u263A","\u263B","\u263C","\u2601","\u2602","\u2603","\u2709","\u260E","\u2604","small-backspace"]},{class:"row3",keyClass:"key-15px-slim",keys:["\u2630","\u2631","\u2632","\u2633","\u2634","\u2635","\u271C","\u2660","\u2666","\u2665","\u2663","small-enter"]},{class:"row4",keyClass:"key-15px-slim",keys:["\u2636","\u2637","n+","-","\u272B","\u2732","\u25C7","\u25A1","\u25B3","\u25BD","\u25CE"]},{class:"row5",keyClass:"key-15px-slim",keys:["\u2794","\u2795","\u2796","\u2797","\u272C","\u2731","\u25C6","\u2588","\u25B2","\u25BC","\u2715","small-space"]}]}},Nt={backspace:!0,enter:!0,caps:!0,shift:!0,space:!0,"small-enter":!0,"small-backspace":!0,"small-space":!0,hiragana:!0,katakana:!0,maru:!0,tenten:!0,komoji:!0},$t={backspace:!0,enter:!0,caps:!0,shift:!0,space:!0,"small-enter":!0,"small-backspace":!0,"small-space":!0,hiragana:!0,katakana:!0,maru:!0,tenten:!0,komoji:!0},Dt={backspace:[1,1],enter:[1,1],caps:[1,1],shift:[1,1],space:[1,29],"small-enter":[1,0],"small-backspace":[1,1],"small-space":[1,0],hiragana:[1,1],katakana:[1,1],maru:[1,1],tenten:[1,1],komoji:[1,1]},Vt={"small-enter":"small-enter","small-space":"small-space",\u00E0:"key-notched-tl key-wide",\u00EC:"key-wide",\u00F9:"key-wide",\u00E8:"key-wide",\u00F2:"key-notched-bl key-wide",hiragana:"key-notched-tl",\u30FC:"key-notched-tr",komoji:"key-notched-bl","!":"key-notched-tl key-wide","\u20AC":"key-notched-tr","+":"key-wide","\u300C":"key-wide","%":"key-wide","^":"key-notched-bl key-wide",n1:"key-notched-tl key-wide",\u03C0:"key-notched-tr","\u2638":"key-wide","\u2630":"key-wide","\u2636":"key-wide","\u2794":"key-notched-bl key-wide"},Ot={\u3042:"\u3041",\u3044:"\u3043",\u3046:"\u3045",\u3048:"\u3047",\u304A:"\u3049",\u3064:"\u3063",\u3084:"\u3083",\u3086:"\u3085",\u3088:"\u3087",\u308F:"\u308E",\u30A2:"\u30A1",\u30A4:"\u30A3",\u30A6:"\u30A5",\u30A8:"\u30A7",\u30AA:"\u30A9",\u30C4:"\u30C3",\u30E4:"\u30E3",\u30E6:"\u30E5",\u30E8:"\u30E7",\u30EF:"\u30EE"},It={\u304B:"\u304C",\u304D:"\u304E",\u304F:"\u3050",\u3051:"\u3052",\u3053:"\u3054",\u3055:"\u3056",\u3057:"\u3058",\u3059:"\u305A",\u305B:"\u305C",\u305D:"\u305E",\u305F:"\u3060",\u3061:"\u3062",\u3064:"\u3065",\u3066:"\u3067",\u3068:"\u3069",\u306F:"\u3070",\u3072:"\u3073",\u3075:"\u3076",\u3078:"\u3079",\u307B:"\u307C",\u30AB:"\u30AC",\u30AD:"\u30AE",\u30AF:"\u30B0",\u30B1:"\u30B2",\u30B3:"\u30B4",\u30B5:"\u30B6",\u30B7:"\u30B8",\u30B9:"\u30BA",\u30BB:"\u30BC",\u30BD:"\u30BE",\u30BF:"\u30C0",\u30C1:"\u30C2",\u30C4:"\u30C5",\u30C6:"\u30C7",\u30C8:"\u30C9",\u30CF:"\u30D0",\u30D2:"\u30D3",\u30D5:"\u30D6",\u30D8:"\u30D9",\u30DB:"\u30DC"},Lt={\u306F:"\u3071",\u3072:"\u3074",\u3075:"\u3077",\u3078:"\u307A",\u307B:"\u307D",\u30CF:"\u30D1",\u30D2:"\u30D4",\u30D5:"\u30D7",\u30D8:"\u30DA",\u30DB:"\u30DD"},Ut={n1:"1","n+":"+"};const Yt={name:"TypingBubble",components:{WPlate:j},props:{highlight:{type:Boolean,required:!0},offsetX:{type:Number,required:!0},offsetY:{type:Number,required:!0},showBubble:{type:Boolean,required:!1,default:!0}}};function Xt(e,t,o,a,i,s){const r=k("w-plate");return d(),f("div",{class:"drag-box",style:g({transform:`translate(${this.offsetX}px, ${this.offsetY}px)`})},[o.showBubble?(d(),N(r,{key:0,class:"box-balloon",padding:0,"tile-name":o.highlight?"main-color-fill":"main-button",notch:[!1,!1,!0,!0]},{default:S(()=>[L(e.$slots,"default",{},void 0,!0)]),_:3},8,["tile-name"])):B("",!0),L(e.$slots,"outside",{},void 0,!0)],4)}var Gt=x(Yt,[["render",Xt],["__scopeId","data-v-798af482"]]);const Kt={name:"Keyboard",emits:["keyboard-key-press","symbol-drag","keyboard-swap-char"],components:{TypingBubble:Gt,WButton:W,WPlate:j},props:{mode:{type:String,required:!0},symbolDrop:{type:Boolean,required:!1,default:!0}},data:function(){return{shifting:!1,capsLocked:!1,draggingSymbol:null,draggingOffsetX:0,draggingOffsetY:0,draggingShow:!1,typingBubbleSymbol:null,typingBubbleOffsetX:0,typingBubbleOffsetY:0,typingBubbleHighlight:!1}},created:function(){this.layouts=Object.freeze(Bt),this.uniqueKeyTile=Nt,this.uniqueKeyIcon=$t,this.uniqueKeyIconMargin=Dt,this.uniqueKeyClass=Vt,this.keyRepeatInterval=null,this.previousKey=void 0},mounted:function(){this.draggingCapturedElement=null,this.unhighlightTypingBubbleDbounced=m.exports.debounce(this.unhighlightTypingBubble,150),this.hideTypingBubbleDbounced=m.exports.debounce(this.hideTypingBubble,500),this.startKeyRepeatDebounced=m.exports.debounce(this.startKeyRepeat,750),fe(()=>this.mode,()=>{this.shifting=!1,this.capsLocked=!1})},beforeUnmount:function(){this.unhighlightTypingBubbleDbounced.cancel(),this.unhighlightTypingBubbleDbounced=void 0,this.hideTypingBubbleDbounced.cancel(),this.hideTypingBubbleDbounced=void 0,this.startKeyRepeatDebounced.cancel(),this.startKeyRepeatDebounced=void 0,this.keyRepeatInterval&&clearInterval(this.keyRepeatInterval)},computed:{keyboardStyle:function(){const e={};return this.$global.rgbMode?(e["--btn-color-normal"]="#ffebeb",e["--btn-color-sp"]="#ffcbcb"):(e["--btn-color-normal"]="#EBEBEB",e["--btn-color-sp"]="#cbcbcb"),e}},methods:{keyDown:function(e,t){if(this.$global.audio.playProgram("pc-keydown"),!this.uniqueKeyIcon[e]){const o=t.target;this.typingBubbleOffsetX=Math.round(o.offsetParent.offsetLeft+o.offsetWidth/2),this.typingBubbleOffsetY=Math.round(o.offsetParent.offsetTop+o.offsetHeight/2),this.typingBubbleSymbol=e,this.typingBubbleHighlight=!0,this.unhighlightTypingBubbleDbounced(),this.hideTypingBubbleDbounced()}(!this.uniqueKeyIcon[e]||e==="enter"||e==="backspace"||e==="space"||e==="small-enter"||e==="small-backspace"||e==="small-space")&&this.startKeyRepeatDebounced(e)},keyUp:function(e,t,o=!1){if(o)this.$global.audio.playProgram("pc-keyup",{vibrate:.15});else{if(this.startKeyRepeatDebounced!=null&&this.startKeyRepeatDebounced.cancel(),this.keyRepeatInterval){clearInterval(this.keyRepeatInterval),this.keyRepeatInterval=null;return}this.$global.audio.playProgram("pc-keyup")}if(e==="shift"?(this.shifting=!this.shifting,this.capsLocked=!1):e==="caps"||e==="katakana"?(this.capsLocked=!this.capsLocked,this.shifting=this.capsLocked):e==="hiragana"?(this.shifting=!1,this.capsLocked=!1):this.shifting&&!this.capsLocked&&(this.shifting=!1),e==="komoji"||e==="tenten"||e==="maru"){let a;e==="komoji"?a=Ot[this.previousKey]:e==="tenten"?a=It[this.previousKey]:e==="maru"&&(a=Lt[this.previousKey]),a&&this.$emit("keyboard-swap-char",this.getKey(a));return}this.previousKey=e,this.$emit("keyboard-key-press",this.getKey(e))},keyLeave:function(){this.startKeyRepeatDebounced!=null&&this.startKeyRepeatDebounced.cancel(),this.keyRepeatInterval&&(clearInterval(this.keyRepeatInterval),this.keyRepeatInterval=null)},startKeyRepeat:function(e){this.keyRepeatInterval&&clearInterval(this.keyRepeatInterval),this.keyRepeatInterval=setInterval(()=>this.keyUp(e,null,!0),75)},unhighlightTypingBubble:function(){this.typingBubbleHighlight=!1},hideTypingBubble:function(){this.typingBubbleSymbol=null},pointerDown:function(e){e.buttons&1&&e.target.classList[0]==="text"&&(e.target.addEventListener("pointerleave",this.pointerLeave),e.target.releasePointerCapture(e.pointerId),this.draggingCapturedElement=e.target),this.keyboardRect=void 0},pointerLeave:function(e){this.draggingCapturedElement&&(this.$global.vibration>0&&window.navigator.vibrate&&window.navigator.vibrate(this.$global.vibration*.8),this.hideTypingBubbleDbounced.flush(),this.draggingCapturedElement.removeEventListener("pointerleave",this.pointerLeave),this.$refs.keyboard.setPointerCapture(e.pointerId),this.symbolDrop&&(this.draggingSymbol=this.draggingCapturedElement.innerText,this.draggingSymbol===""&&(this.draggingSymbol=null)))},pointerMove:function(e){this.draggingSymbol&&requestAnimationFrame(()=>{this.draggingSymbol&&e.target.classList[0]==="keyboard"&&(this.keyboardRect||(this.keyboardRect=e.target.getBoundingClientRect()),this.draggingShow=!0,this.draggingOffsetX=(e.clientX-this.keyboardRect.x)/this.$global.scalingFactor,this.draggingOffsetY=(e.clientY-this.keyboardRect.y)/this.$global.scalingFactor)})},pointerUp:function(e){this.draggingSymbol&&(this.previousKey=this.draggingSymbol,this.$emit("symbol-drag",{symbol:this.getKey(this.draggingSymbol),event:e})),this.$refs.keyboard.releasePointerCapture(e.pointerId),this.draggingCapturedElement&&(this.draggingCapturedElement.releasePointerCapture(e.pointerId),this.draggingCapturedElement=null),this.draggingShow=!1,this.draggingSymbol=null},pointerCancel:function(e){this.$refs.keyboard.releasePointerCapture(e.pointerId),this.draggingCapturedElement&&(this.draggingCapturedElement.releasePointerCapture(e.pointerId),this.draggingCapturedElement=null),this.draggingShow=!1,this.draggingSymbol=null},getKey:function(e){let t=Ut[e];return t??e}}},Ft={key:0,class:"text"},Ht={class:"symbol-drag-box-char"};function zt(e,t,o,a,i,s){const r=k("w-button"),n=k("typing-bubble"),c=k("w-plate");return d(),N(c,be({"tile-name":"main-foreground",padding:0},e.$attrs,{notch:[!0,!0,!0,!0]}),{default:S(()=>[e.layouts[o.mode]?(d(),f("div",{key:0,class:_(["keyboard",o.mode]),ref:"keyboard",style:g(s.keyboardStyle),onPointerdown:t[0]||(t[0]=(...l)=>s.pointerDown&&s.pointerDown(...l)),onPointermove:t[1]||(t[1]=(...l)=>s.pointerMove&&s.pointerMove(...l)),onPointerup:t[2]||(t[2]=(...l)=>s.pointerUp&&s.pointerUp(...l)),onPointercancel:t[3]||(t[3]=(...l)=>s.pointerCancel&&s.pointerCancel(...l))},[(d(!0),f(T,null,D(e.layouts[o.mode].sections,(l,u)=>(d(),f("div",{key:u,class:_(l.class)},[(d(!0),f(T,null,D(l.keys,(p,M)=>(d(),N(r,{key:p,text:p,class:_(e.uniqueKeyClass[p]?e.uniqueKeyClass[p]:l.keyClass),"normal-class":e.uniqueKeyTile[p]?"keyboard-spbutton-normal":"keyboard-button-normal","active-class":e.uniqueKeyTile[p]?"keyboard-spbutton-active":"keyboard-button-active","icon-prefix-normal":"icon-keyboard-normal","icon-prefix-highlight":"icon-keyboard-highlight",icon:e.uniqueKeyIcon[p]?p:null,"icon-margin":e.uniqueKeyIconMargin[p],onPointerdown:y=>s.keyDown(e.shifting?l.shiftKeys[M]:p,y),onPointerup:y=>s.keyUp(e.shifting?l.shiftKeys[M]:p,y),onPointerleave:s.keyLeave,toggled:p==="shift"&&e.shifting&&!e.capsLocked||p==="caps"&&e.capsLocked||p==="hiragana"&&!e.capsLocked&&!e.shifting||p==="katakana"&&(e.capsLocked||e.shifting)},{default:S(()=>[e.uniqueKeyIcon[p]==null?(d(),f("div",Ft,E(e.shifting?l.shiftKeys[M]:s.getKey(p)),1)):B("",!0)]),_:2},1032,["text","class","normal-class","active-class","icon","icon-margin","onPointerdown","onPointerup","onPointerleave","toggled"]))),128))],2))),128))],38)):B("",!0),ge(w(n,{"show-bubble":e.$global.mobileAssists,highlight:!1,"offset-x":e.draggingOffsetX,"offset-y":e.draggingOffsetY},{outside:S(()=>[h("div",Ht,E(e.draggingSymbol),1)]),default:S(()=>[$(E(e.draggingSymbol)+" ",1)]),_:1},8,["show-bubble","offset-x","offset-y"]),[[me,e.draggingShow]]),ge(w(n,{highlight:e.typingBubbleHighlight,"offset-x":e.typingBubbleOffsetX,"offset-y":e.typingBubbleOffsetY},{default:S(()=>[$(E(e.typingBubbleSymbol),1)]),_:1},8,["highlight","offset-x","offset-y"]),[[me,e.typingBubbleSymbol&&e.$global.mobileAssists]])]),_:1},16)}var re=x(Kt,[["render",zt],["__scopeId","data-v-64cf70d6"]]);const qt={name:"WButtonToggle",emits:["update:modelValue"],components:{WButton:W},props:{modelValue:{type:String,required:!0},options:{type:Array,required:!0},commonOptions:{type:Object,required:!1,default:null},clickCallbacks:{type:Array,required:!1,default:null}},data:function(){return{internalValue:this.modelValue}},methods:{onClick:function(e,t){this.internalValue=e.name,this.$emit("update:modelValue",e.name),this.clickCallbacks&&this.clickCallbacks[t]()}}};function jt(e,t,o,a,i,s){const r=k("w-button");return d(),f("div",null,[(d(!0),f(T,null,D(o.options,(n,c)=>(d(),N(r,be({key:n.name},{...n,...o.commonOptions},{onClick:l=>s.onClick(n,c),toggled:e.internalValue===n.name}),{default:S(()=>[L(e.$slots,n.name)]),_:2},1040,["onClick","toggled"]))),128))])}var le=x(qt,[["render",jt]]);const Wt={name:"WTextInput",emits:["update:modelValue"],props:{chars:{type:Number,required:!1,default:10},lines:{type:Number,required:!1,default:1},modelValue:{type:String,required:!0}},data:function(){return{denyBlink:!1}},computed:{lineSize:function(){return Math.round(this.chars/this.lines)},caretPosition:function(){return this.modelValue.length},getPreBorderLeft:function(){this.$global.superSample;const e={},t=this.$tileMap("grid-background-input-pre-border-left");return e.backgroundImage=`url(${t.url})`,e},getBorderLeftStyle:function(){this.$global.superSample;const e={},t=this.$tileMap("grid-background-input-border-left");return e.backgroundImage=`url(${t.url})`,e},getInputStyle:function(){this.$global.superSample;const e={},t=this.$tileMap("grid-background-input");return e.backgroundImage=`url(${t.url})`,e},getPostBorderRight:function(){this.$global.superSample;const e={},t=this.$tileMap("grid-background-input-post-border-right");return e.backgroundImage=`url(${t.url})`,e},getCaretStyle:function(){this.$global.superSample;const e={},t=this.$tileMap("grid-background-input-caret");return e.backgroundImage=`url(${t.url})`,e}},methods:{deny:function(){this.$global.audio.playProgram("pc-deny"),this.denyBlink=!0},mainTransitionEnd:function(){this.denyBlink=!1,this.$refs.main.classList.remove("deny")}}};function Qt(e,t,o,a,i,s){return d(),f("div",{class:_(["input",e.denyBlink&&"deny"]),ref:"main",onTransitionend:t[0]||(t[0]=(...r)=>s.mainTransitionEnd&&s.mainTransitionEnd(...r))},[(d(!0),f(T,null,D([...Array(o.lines).keys()],r=>(d(),f("div",{key:r,class:"input-line"},[h("div",{class:"tile tile-input-border",style:g(s.getPreBorderLeft)},null,4),(d(!0),f(T,null,D([...Array(s.lineSize).keys()],n=>(d(),f(T,{key:n},[r*s.lineSize+n===s.caretPosition?(d(),f("div",{key:0,class:"tile tile-input tile-caret",style:g(s.getCaretStyle)},null,4)):n===0?(d(),f("div",{key:1,class:"tile tile-input",style:g(s.getBorderLeftStyle)},E(o.modelValue.substring(r*s.lineSize+n,r*s.lineSize+n+1)),5)):(d(),f("div",{key:2,class:"tile tile-input",style:g(s.getInputStyle)},E(o.modelValue.substring(r*s.lineSize+n,r*s.lineSize+n+1)),5))],64))),128)),h("div",{class:"tile tile-input-border",style:g(s.getPostBorderRight)},null,4)]))),128))],34)}var ce=x(Wt,[["render",Qt],["__scopeId","data-v-6ddcc845"]]);const Jt={name:"HomeName",components:{WTextInput:ce,WButtonToggle:le,Keyboard:re},emits:["name-selected","done","back"],data:function(){return{keyboardMode:"romaji",userName:"",faded:!0}},computed:{},created:function(){const e={enter:()=>{},"small-enter":()=>{},backspace:()=>this.keyPressBackspace(),"small-backspace":()=>this.keyPressBackspace(),space:()=>this.keyPress(" "),"small-space":()=>this.keyPress(" "),shift:()=>{},caps:()=>{},hiragana:()=>{},katakana:()=>{},komoji:()=>{}};this.specialKeys=e},mounted:function(){this.userName=this.$global.userName,setTimeout(()=>{this.faded=!1},16)},methods:{keyPress:function(e){this.specialKeys[e]?this.specialKeys[e](e):this.userName.length<10&&(this.userName+=e)},swapChar:function(e){this.userName.length>=0&&(this.userName=this.userName.substring(0,this.userName.length-1)+e)},keyPressBackspace:function(){this.userName.length>0&&(this.userName=this.userName.substring(0,this.userName.length-1))},mainTransitionEnd:function(e){e.propertyName==="opacity"&&this.mainTransitionEndCallback&&(this.mainTransitionEndCallback(),this.mainTransitionEndCallback=void 0)},done:async function(){if(this.userName.length<=0){this.$refs["text-input"].deny();return}this.$emit("name-selected",this.userName),this.mainTransitionEndCallback=()=>{this.$emit("done")},this.faded=!0},back:async function(){this.mainTransitionEndCallback=()=>{this.$emit("back")},this.faded=!0}}},Zt={class:"keyboard-wrapper"},eo={class:"keyboard-buttons-wrapper"};function to(e,t,o,a,i,s){const r=k("w-text-input"),n=k("w-button-toggle"),c=k("keyboard");return d(),f("div",{class:_(["main",e.faded&&"main-fade"]),onTransitionend:t[2]||(t[2]=z((...l)=>s.mainTransitionEnd&&s.mainTransitionEnd(...l),["self"]))},[w(r,{modelValue:e.userName,"onUpdate:modelValue":t[0]||(t[0]=l=>e.userName=l),class:"name-field",ref:"text-input"},null,8,["modelValue"]),h("div",Zt,[h("div",eo,[w(n,{class:"keyboard-buttons-toggle global-color-hue-tint",modelValue:e.keyboardMode,"onUpdate:modelValue":t[1]||(t[1]=l=>e.keyboardMode=l),"common-options":{"normal-tile":"beveled-button","active-tile":"beveled-button-highlight","plate-padding":2,"audio-feedback":!0,"icon-prefix-highlight":"icon-normal"},options:[{icon:"romaji",name:"romaji"},{icon:"accents",name:"accents"},{icon:"kana",name:"kana"},{icon:"symbols1",name:"symbols1"},{icon:"symbols2",name:"symbols2"}]},null,8,["modelValue"])]),w(c,{class:"keyboard",mode:e.keyboardMode,"symbol-drop":!1,onKeyboardKeyPress:s.keyPress,onKeyboardSwapChar:s.swapChar},null,8,["mode","onKeyboardKeyPress","onKeyboardSwapChar"])])],34)}var oo=x(Jt,[["render",to],["__scopeId","data-v-dc639b84"]]);const so={name:"HomeColor",components:{WPlate:j},emits:["color-selected","done","back"],data:function(){return{colors:Se,colorsPerRow:4,selectedColorIndex:0,colorSwatchRefs:[],colorSwatchDisplay:[],colorBoxPos:{x:0,y:0},faded:!0}},computed:{colorsRows:function(){return this.colors.length/this.colorsPerRow},selectedColorStyle:function(){return{backgroundColor:this.colors[this.selectedColorIndex]}},selectedColorBoxStyle:function(){const e={borderColor:this.colors[this.selectedColorIndex]},t=this.colorBoxPos.x-this.colorMarginSize/2*this.$global.superSample,o=this.colorBoxPos.y-this.colorMarginSize/2*this.$global.superSample;return e.transform=`translateX(${t}px) translateY(${o}px)`,e},mainStyle:function(){return{"--color-margin-size":this.colorMarginSize,"--color-size":this.colorSize}}},created:function(){this.colorSwatchDisplayOrder=[0,1,2,3,7,11,15,14,13,12,8,4,5,6,10,9],this.colorMarginSize=8,this.colorSize=16,this.selectedColorIndex=this.$global.userColorIndex},mounted:function(){this.colorBoxPath=[],this.colorSwatchRefs[this.selectedColorIndex]&&(this.colorBoxPos.x=this.colorSwatchRefs[this.selectedColorIndex].offsetLeft,this.colorBoxPos.y=this.colorSwatchRefs[this.selectedColorIndex].offsetTop),this.mainTransitionEndCallback=()=>this.colorSwatchDisplayEffect(this.colorSwatchDisplayOrder,!0),this.faded=!1},methods:{mainTransitionEnd:function(e){e.propertyName==="opacity"&&this.mainTransitionEndCallback&&(this.mainTransitionEndCallback(),this.mainTransitionEndCallback=void 0)},colorSwatchDisplayEffect:function(e,t,o,a,i){this.colorSwatchDisplayLock=!0,(i!=null&&a==null||i-a>32)&&(e=e.slice(),this.colorSwatchDisplay[e.shift()]=t,a=i),e.length>0?requestAnimationFrame(s=>this.colorSwatchDisplayEffect(e,t,o,a,s)):(this.colorSwatchDisplayLock=!1,o&&o())},setColorRef:function(e,t){this.colorSwatchRefs[t]=e},setColorIndex:function(e){this.$global.audio.playProgram("pc-click");const t=this.colorSwatchRefs[this.selectedColorIndex],o=this.colorSwatchRefs[e],a=(this.colorSize+this.colorMarginSize*2)*this.$global.superSample;this.colorBoxNewPath({x:t.offsetLeft,y:t.offsetTop},{x:o.offsetLeft,y:o.offsetTop},a),this.colorBoxRunPath(),this.selectedColorIndex=e,this.$emit("color-selected",e)},colorBoxTransitionEnd:function(){this.colorBoxRunPath()},colorBoxNewPath:function(e,t,o){this.colorBoxPath=[];const a=Math.round(Math.abs(e.x-t.x)/o),i=Math.round(Math.abs(e.y-t.y)/o),s=e;for(let r=1;r<=a;++r)s.x=s.x+(t.x-e.x)/a*r,this.colorBoxPath.push({x:s.x,y:s.y});for(let r=1;r<=i;++r)s.y=s.y+(t.y-e.y)/i*r,this.colorBoxPath.push({x:s.x,y:s.y})},colorBoxRunPath:function(){const e=this.colorBoxPath.shift();e&&(this.colorBoxPos=e)},done:function(){this.colorSwatchDisplayLock||this.colorSwatchDisplayEffect(this.colorSwatchDisplayOrder.reverse(),!1,()=>{this.mainTransitionEndCallback=()=>this.$emit("done"),this.faded=!0})},back:function(){this.colorSwatchDisplayLock||this.colorSwatchDisplayEffect(this.colorSwatchDisplayOrder.reverse(),!1,()=>{this.mainTransitionEndCallback=()=>this.$emit("back"),this.faded=!0})}}},ao=e=>(ye("data-v-a98a3b3a"),e=e(),ke(),e),io={class:"window-colors-content"},no=["onClick"],ro=ao(()=>h("div",{class:"window-header"},"Selected",-1)),lo={class:"window-content"};function co(e,t,o,a,i,s){const r=k("w-plate");return d(),f("div",{class:_(["main",e.faded&&"main-fade"]),style:g(s.mainStyle),onTransitionend:t[1]||(t[1]=z((...n)=>s.mainTransitionEnd&&s.mainTransitionEnd(...n),["self"]))},[w(r,{class:"colors-window","tile-name":"thin-frame",padding:2},{default:S(()=>[h("div",io,[h("div",{class:"selected-color-box",style:g(s.selectedColorBoxStyle),onTransitionend:t[0]||(t[0]=z((...n)=>s.colorBoxTransitionEnd&&s.colorBoxTransitionEnd(...n),["stop"]))},null,36),(d(!0),f(T,null,D(s.colorsRows,(n,c)=>(d(),f("div",{key:c,class:"color-row"},[(d(!0),f(T,null,D(e.colors.filter((l,u)=>Math.floor(u/e.colorsPerRow)===c),(l,u)=>(d(),f("div",{key:u,class:"color-frame color-frame-margin",ref:p=>s.setColorRef(p,c*e.colorsPerRow+u),style:g({backgroundColor:l,visibility:this.colorSwatchDisplay[c*e.colorsPerRow+u]?void 0:"hidden"}),onClick:p=>s.setColorIndex(c*e.colorsPerRow+u)},null,12,no))),128))]))),128))])]),_:1}),w(r,{class:"selected-color-window","tile-name":"thin-frame",padding:2},{default:S(()=>[ro,h("div",lo,[h("div",{class:"color-frame-big color-frame-big-margin",style:g(s.selectedColorStyle)},null,4)])]),_:1})],38)}var uo=x(so,[["render",co],["__scopeId","data-v-a98a3b3a"]]);const ho=function(){return[{description:"ON",value:!0},{description:"OFF",value:!1}]},po={name:"WToggleSwitch",components:{WButton:W,WPlate:j},emits:["update:modelValue"],props:{modelValue:{required:!1,default:null},options:{type:Array,required:!1,default:ho()},buttonSize:{type:Number,required:!1,default:15}},data:function(){return{selectedIndex:0}},computed:{toggleStyle:function(){return{"--switch-button-size":this.buttonSize}},getButtonStyle:function(){const e={};return e.top=this.selectedIndex*this.buttonSize*this.$global.superSample+"px",e}},mounted:function(){fe(()=>this.modelValue,e=>{this.selectedIndex=this.options.findIndex(t=>t.value===e)},{immediate:!0})},methods:{toggle:function(){this.$global.audio.playProgram("pc-click"),this.selectedIndex+=1,this.selectedIndex>this.options.length-1&&(this.selectedIndex=0),this.$emit("update:modelValue",this.options[this.selectedIndex].value)}}},fo={class:"toggle-switch-description-wrapper"},go={class:"toggle-switch-description"},mo={class:"toggle-switch-button-wrapper"};function bo(e,t,o,a,i,s){const r=k("w-button"),n=k("w-plate");return d(),N(n,{class:"toggle-switch","tile-name":"thin-frame",padding:2,style:g(s.toggleStyle)},{default:S(()=>[h("div",fo,[h("div",go,[L(e.$slots,"default",{},void 0,!0)])]),h("div",mo,[(d(!0),f(T,null,D(o.options,(c,l)=>(d(),f("div",{key:l,class:_(["options-text",l===e.selectedIndex?"text-selected":c.recommended&&"text-recommended"])},E(c.description),3))),128)),w(r,{class:"toggle-switch-button global-color-hue-tint","plate-padding":2,"expand-plate":"",style:g(s.getButtonStyle),"normal-tile":"beveled-button","active-tile":"beveled-button-highlight",onClick:s.toggle},null,8,["style","onClick"])])]),_:3},8,["style"])}var yo=x(po,[["render",bo],["__scopeId","data-v-ecf6402c"]]);const ko=e=>new Promise(t=>{e.toBlob(o=>{t(o)},"image/png")}),Ne=function(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),o=parseInt(t[1],16),a=parseInt(t[2],16),i=parseInt(t[3],16);return{r:o,g:a,b:i}},vs=function(e){const t=new DataView(e.buffer,e.byteOffset),o=t.getUint32(0),a=t.getUint32(4);if(o!==2303741511||a!==218765834)return null;const i=t.getUint32(8,!1);if(t.getUint32(12,!1)!==1229472850||i!==13)return null;const r=t.getUint32(16,!1),n=t.getUint32(20,!1);return r<=0||n<=0?null:{width:r,height:n}},$e=e=>new Promise(t=>setTimeout(t,e)),wo=[{description:"Off",value:0},{description:"Weak",value:70},{description:"Strong",value:120}],vo=[{description:"Auto",value:0,recommended:!0},{description:"Landscape",value:1},{description:"Portrait",value:2}],So=[{description:"1x",value:1},{description:"2x",value:2},{description:"3x",value:3},{description:"4x",value:4}],_o=[{description:"Sharp",value:"rendering-pixel"},{description:"Smooth",value:"rendering-quality",recommended:!0}],Ro=[{description:"ON",value:!1,recommended:!0},{description:"OFF",value:!0}],ue=[{description:"ON",value:!0},{description:"OFF",value:!1}],Co=[{description:"42",value:42},{description:"64",value:64,recommended:!0},{description:"128",value:128},{description:"256",value:256}],xo=[{description:"ON",value:!0,recommended:!0},{description:"OFF",value:!1}];const Eo={name:"HomeColor",components:{WToggleSwitch:yo},emits:["done","back"],data:function(){let e=this.$global.isTouchScreen;return ue[0].recommended=e,ue[1].recommended=!e,{settingsArray:["vibration","orientation","sound","autoScale","mobileAssists","upscaleStyle","superSampling","chatQueueLimit"],settings:{vibration:{options:wo,description:"Rumble",onChange:this.changeVibration},orientation:{options:vo,description:"Orient.",onChange:this.changeOrientation},sound:{options:Ro,description:"Sound",onChange:this.changeSound},autoScale:{options:xo,description:"Auto Scale",onChange:this.changeAutoScale},mobileAssists:{options:ue,description:"Mobile Assists",onChange:this.changeMobileAssists},upscaleStyle:{options:_o,description:"Bitmap Upscale",onChange:this.changeUpscaleStyle},superSampling:{options:se(()=>this.superSamplingOptions),description:"Super Sampling",onChange:this.changeSuperSampling},chatQueueLimit:{options:Co,description:"Max Chat History",onChange:this.changeChatQueueLimit}},vibration:void 0,settingsRefs:[],settingsDisplay:[],faded:!0}},computed:{superSamplingOptions:function(){const e=this.$global.renderingClass,t=m.exports.cloneDeep(So);return e==="rendering-quality"?this.$global.isTouchScreen?t[1].recommended=!0:t[2].recommended=!0:e==="rendering-pixel"&&(t[1].recommended=!0),t}},created:function(){},mounted:function(){this.settings.vibration.value=this.$global.vibration,this.settings.orientation.value=this.$global.orientation,this.settings.sound.value=this.$global.muted,this.settings.autoScale.value=this.$global.autoScale,this.settings.mobileAssists.value=this.$global.mobileAssists,this.settings.upscaleStyle.value=this.$global.renderingClass,this.settings.superSampling.value=this.$global.superSample,this.settings.chatQueueLimit.value=this.$global.chatQueueLimit,setTimeout(()=>{this.faded=!1},16),this.settingsDisplayEffect([...Array(Object.keys(this.settings).length).keys()],!0)},methods:{done:async function(){await this.settingsDisplayEffect([...Array(Object.keys(this.settings).length).keys()].reverse(),!1),this.mainTransitionEndCallback=()=>{this.$emit("done")},this.faded=!0},back:async function(){await this.settingsDisplayEffect([...Array(Object.keys(this.settings).length).keys()].reverse(),!1),this.mainTransitionEndCallback=()=>{this.$emit("back")},this.faded=!0},mainTransitionEnd:function(e){e.propertyName==="opacity"&&this.mainTransitionEndCallback&&(this.mainTransitionEndCallback(),this.mainTransitionEndCallback=void 0)},setSettingRef:function(e,t){this.settingsRefs[t]=e},settingsDisplayEffect:async function(e,t){for(let o=0;o<e.length;++o)await $e(66),this.settingsDisplay[e[o]]=t},changeVibration:function(e){this.$global.setVibration(e),e>0&&window.navigator.vibrate&&window.navigator.vibrate(e)},changeSound:function(e){this.$global.setVolume(e?0:1)},changeOrientation:function(e){this.$global.orientation=e},changeAutoScale:function(e){this.$global.autoScale=e},changeMobileAssists:function(e){this.$global.mobileAssists=e},changeUpscaleStyle:function(e){this.$global.renderingClass=e},changeSuperSampling:function(e){this.$global.setSuperSample(e)},changeChatQueueLimit:function(e){this.$global.chatQueueLimit=e}}};function To(e,t,o,a,i,s){const r=k("w-toggle-switch");return d(),f("div",{class:_(["main",e.faded&&"main-fade"]),onTransitionend:t[0]||(t[0]=z((...n)=>s.mainTransitionEnd&&s.mainTransitionEnd(...n),["self"]))},[(d(!0),f(T,null,D(e.settingsArray,(n,c)=>(d(),N(r,{key:c,modelValue:e.settings[n].value,"onUpdate:modelValue":[l=>e.settings[n].value=l,l=>e.settings[n].onChange(l)],options:e.settings[n].options,ref:l=>s.setSettingRef(l,c),class:_(["switch",!this.settingsDisplay[c]&&"switch-hidden"])},{default:S(()=>[$(E(e.settings[n].description),1)]),_:2},1032,["modelValue","onUpdate:modelValue","options","class"]))),128))],34)}var Mo=x(Eo,[["render",To],["__scopeId","data-v-c0054274"]]);const Po={name:"ModalDialog",components:{WPlate:j},props:{padding:{type:Number,default:8},show:{type:Boolean,required:!0,default:!1}},data:function(){return{plateViewHeight:0}},computed:{plateStyle:function(){const e={},t=6,a=(2*Math.floor(this.plateViewHeight/this.$global.superSample/t/2)+1)*t*this.$global.superSample;return e.height=`${a}px`,e}},mounted:function(){this.onResizeThrottled=()=>requestAnimationFrame(()=>{this.onResize()}),this.slotWrapper=new ResizeObserver(this.onResizeThrottled).observe(this.$refs["slot-wrapper"])},beforeUnmount:function(){this.slotWrapper&&this.slotWrapper.unobserve(this.$refs["slot-wrapper"])},methods:{onResize:function(){this.$refs["slot-wrapper"]&&(this.plateViewHeight=this.$refs["slot-wrapper"].offsetHeight)}}},Ao={ref:"slot-wrapper",class:"slot-wrapper"};function Bo(e,t,o,a,i,s){const r=k("w-plate");return d(),N(He,{to:"#modal-teleport-target"},[h("div",{class:_(["modal-container",!o.show&&"hide"])},[w(r,{"tile-name":"modal-dialog","tile-mode":"",padding:o.padding,class:_(["modal-plate",!o.show&&"hide-plate"]),style:g(s.plateStyle)},{default:S(()=>[h("div",Ao,[L(e.$slots,"default",{},void 0,!0)],512)]),_:3},8,["padding","class","style"])],2)])}var No=x(Po,[["render",Bo],["__scopeId","data-v-06953e52"]]);const $o={name:"HomeLobby",components:{ModalDialog:No,WButton:W,WTextInput:ce,WButtonToggle:le,Keyboard:re},emits:["done","back","custom-server"],data:function(){return{keyboardMode:"romaji",roomCode:"",faded:!0,loading:!1,modal:!1,modalText:"",modalButtonText:"OK",modalCallback:null}},computed:{},created:function(){const e={enter:()=>{},"small-enter":()=>{},backspace:()=>this.keyPressBackspace(),"small-backspace":()=>this.keyPressBackspace(),space:()=>this.keyPress(" "),"small-space":()=>this.keyPress(" "),shift:()=>{},caps:()=>{},hiragana:()=>{},katakana:()=>{},komoji:()=>{}};this.specialKeys=e},mounted:function(){this.roomCode=this.$global.roomCode,setTimeout(()=>{this.faded=!1},16),this.failedAttempts=0},methods:{createNewRoom:async function(){try{this.loading=!0;const e=this.$global.chatClient;e.connected||await e.startConnection(this.$global.serverAddress);const t=await e.sendCreateRoom();this.roomCode=String(t),this.loading=!1}catch(e){(e.name==="ERROR_ROOM_DOES_NOT_EXISTS"||e.name==="ERROR_GENERIC_ERROR")&&(this.failedAttempts+=1,this.modal=!0,this.previousFailedAttemptMessage!=null&&e.message===this.previousFailedAttemptMessage&&this.failedAttempts>1&&this.failedAttempts%2==0?this.modalText="Server could be down, or an adblocker may be inhibiting the websocket connection, if so, please disable it for this page and try again":(this.modalText=e.message,this.previousFailedAttemptMessage=e.message),this.modalCallback=()=>{this.modal=!1}),this.loading=!1}},connectRoom:async function(e){try{const t=this.$global.chatClient;t.connected||await t.startConnection(this.$global.serverAddress),t.roomConnected&&await t.sendLeaveRoom(this.$global.serverAddress),await t.sendConnectRoom(Number(this.roomCode),this.$global.userName,this.$global.userColorIndex),this.$global.roomCode=this.roomCode,e()}catch(t){(t.name==="ERROR_ROOM_DOES_NOT_EXISTS"||t.name==="ERROR_GENERIC_ERROR")&&(this.failedAttempts+=1,this.modal=!0,this.previousFailedAttemptMessage!=null&&t.message===this.previousFailedAttemptMessage&&this.failedAttempts>1&&this.failedAttempts%2==0?this.modalText="Server could be down, or an adblocker may be inhibiting the websocket connection, if so, please disable it for this page and try again":(this.modalText=t.message,this.previousFailedAttemptMessage=t.message),this.modalCallback=()=>{this.modal=!1})}},keyPress:function(e){this.specialKeys[e]?this.specialKeys[e](e):this.roomCode.length<10?this.roomCode+=e:this.$refs["text-input"].deny()},swapChar:function(e){this.roomCode.length>=0&&(this.roomCode=this.roomCode.substring(0,this.roomCode.length-1)+e)},keyPressBackspace:function(){this.roomCode.length>0?this.roomCode=this.roomCode.substring(0,this.roomCode.length-1):this.$refs["text-input"].deny()},mainTransitionEnd:function(e){e.propertyName==="opacity"&&this.mainTransitionEndCallback&&(this.mainTransitionEndCallback(),this.mainTransitionEndCallback=void 0)},done:async function(){if(this.roomCode.length<=0){this.$refs["text-input"].deny();return}this.connectRoom(()=>{this.mainTransitionEndCallback=()=>{this.$emit("done")},this.faded=!0})},back:async function(){this.mainTransitionEndCallback=()=>{this.$emit("back")},this.faded=!0},customServer:function(){this.mainTransitionEndCallback=()=>{this.$emit("custom-server")},this.faded=!0},copyUrl:async function(){await this.$router.replace({name:"Home",query:{v:"lobby",r:this.roomCode,s:this.$global.serverAddress}}),await $e(100);try{await navigator.clipboard.writeText(document.URL),this.modalText="URL with server and room settings copied to the clipboard. Share it for easy access!"}catch{this.modalText="Could not copy URL to the clipboard, try copying it from the address bar and share it for easy access!"}this.modal=!0,this.modalCallback=()=>{this.modal=!1}}}},De=e=>(ye("data-v-3670ea81"),e=e(),ke(),e),Do={class:"code-field"},Vo={class:"buttons"},Oo=$(" New room "),Io=De(()=>h("div",{class:"spacer"},null,-1)),Lo=$(" Custom "),Uo=De(()=>h("div",{class:"spacer"},null,-1)),Yo=$(" \u2668 "),Xo={class:"keyboard-wrapper"},Go={class:"keyboard-buttons-wrapper"},Ko={style:{color:"white"}};function Fo(e,t,o,a,i,s){const r=k("w-text-input"),n=k("w-button"),c=k("w-button-toggle"),l=k("keyboard"),u=k("modal-dialog");return d(),f("div",{class:_(["main",e.faded&&"main-fade"]),onTransitionend:t[2]||(t[2]=z((...p)=>s.mainTransitionEnd&&s.mainTransitionEnd(...p),["self"]))},[h("div",Do,[w(r,{modelValue:e.roomCode,"onUpdate:modelValue":t[0]||(t[0]=p=>e.roomCode=p),ref:"text-input"},null,8,["modelValue"]),h("div",Vo,[w(n,{"plate-padding":3,disabled:e.loading,class:"button","normal-tile":"large-beveled-button","active-tile":"large-beveled-button-inverted",onClick:s.createNewRoom,"audio-feedback":""},{default:S(()=>[Oo]),_:1},8,["disabled","onClick"]),Io,w(n,{"plate-padding":3,disabled:e.loading,class:"button","normal-tile":"large-beveled-button","active-tile":"large-beveled-button-inverted",onClick:s.customServer,"audio-feedback":""},{default:S(()=>[Lo]),_:1},8,["disabled","onClick"]),Uo,w(n,{"plate-padding":3,disabled:e.loading,class:"sm-button","normal-tile":"large-beveled-button","active-tile":"large-beveled-button-inverted",onClick:s.copyUrl,"audio-feedback":""},{default:S(()=>[Yo]),_:1},8,["disabled","onClick"])])]),h("div",Xo,[h("div",Go,[w(c,{class:"keyboard-buttons-toggle global-color-hue-tint",modelValue:e.keyboardMode,"onUpdate:modelValue":t[1]||(t[1]=p=>e.keyboardMode=p),"common-options":{"normal-tile":"beveled-button","active-tile":"beveled-button-highlight","plate-padding":2,"audio-feedback":!0,"icon-prefix-highlight":"icon-normal"},options:[{icon:"romaji",name:"romaji"},{icon:"accents",name:"accents"},{icon:"kana",name:"kana"},{icon:"symbols1",name:"symbols1"},{icon:"symbols2",name:"symbols2"}]},null,8,["modelValue"])]),w(l,{class:"keyboard",mode:e.keyboardMode,"symbol-drop":!1,onKeyboardKeyPress:s.keyPress,onKeyboardSwapChar:s.swapChar},null,8,["mode","onKeyboardKeyPress","onKeyboardSwapChar"])]),w(u,{show:e.modal,padding:16},{default:S(()=>[h("div",Ko,E(e.modalText),1),w(n,{"plate-padding":3,class:"dismiss-button","normal-tile":"large-beveled-button","active-tile":"large-beveled-button-inverted",onClick:e.modalCallback,"audio-feedback":""},{default:S(()=>[$(E(e.modalButtonText),1)]),_:1},8,["onClick"])]),_:1},8,["show"])],34)}var Ho=x($o,[["render",Fo],["__scopeId","data-v-3670ea81"]]);const zo={name:"HomeCustomServer",components:{WButton:W,WTextInput:ce,WButtonToggle:le,Keyboard:re},emits:["done","back"],data:function(){return{keyboardMode:"romaji",faded:!0,loading:!1,serverAddress:"",maxChars:14*3}},computed:{},created:function(){const e={enter:()=>{},"small-enter":()=>{},backspace:()=>this.keyPressBackspace(),"small-backspace":()=>this.keyPressBackspace(),space:()=>this.keyPress(" "),"small-space":()=>this.keyPress(" "),shift:()=>{},caps:()=>{},hiragana:()=>{},katakana:()=>{},komoji:()=>{}};this.specialKeys=e},mounted:function(){this.serverAddress=this.$global.serverAddress,setTimeout(()=>{this.faded=!1},16)},methods:{testChange:async function(e){try{this.loading=!0;const t=this.$global.chatClient;t.connected&&await t.endConnection(),await t.startConnection(this.serverAddress),this.$global.serverAddress=this.serverAddress,this.loading=!1,e()}catch{this.$refs["text-input"].deny(),this.loading=!1}},keyPress:function(e){this.specialKeys[e]?this.specialKeys[e](e):this.serverAddress.length<this.maxChars?this.serverAddress+=e:this.$refs["text-input"].deny()},swapChar:function(e){this.serverAddress.length>=0&&(this.serverAddress=this.serverAddress.substring(0,this.serverAddress.length-1)+e)},keyPressBackspace:function(){this.serverAddress.length>0?this.serverAddress=this.serverAddress.substring(0,this.serverAddress.length-1):this.$refs["text-input"].deny()},mainTransitionEnd:function(e){e.propertyName==="opacity"&&this.mainTransitionEndCallback&&(this.mainTransitionEndCallback(),this.mainTransitionEndCallback=void 0)},done:async function(){if(this.serverAddress.length<=0){this.$refs["text-input"].deny();return}this.testChange(()=>{this.mainTransitionEndCallback=()=>{this.$emit("done")},this.faded=!0})},back:async function(){this.mainTransitionEndCallback=()=>{this.$emit("back")},this.faded=!0}}},qo={class:"code-field"},jo={class:"keyboard-wrapper"},Wo={class:"keyboard-buttons-wrapper"};function Qo(e,t,o,a,i,s){const r=k("w-text-input"),n=k("w-button-toggle"),c=k("keyboard");return d(),f("div",{class:_(["main",e.faded&&"main-fade"]),onTransitionend:t[2]||(t[2]=z((...l)=>s.mainTransitionEnd&&s.mainTransitionEnd(...l),["self"]))},[h("div",qo,[w(r,{modelValue:e.serverAddress,"onUpdate:modelValue":t[0]||(t[0]=l=>e.serverAddress=l),ref:"text-input",chars:e.maxChars,lines:3},null,8,["modelValue","chars"])]),h("div",jo,[h("div",Wo,[w(n,{class:"keyboard-buttons-toggle global-color-hue-tint",modelValue:e.keyboardMode,"onUpdate:modelValue":t[1]||(t[1]=l=>e.keyboardMode=l),"common-options":{"normal-tile":"beveled-button","active-tile":"beveled-button-highlight","plate-padding":2,"audio-feedback":!0,"icon-prefix-highlight":"icon-normal"},options:[{icon:"romaji",name:"romaji"},{icon:"accents",name:"accents"},{icon:"kana",name:"kana"},{icon:"symbols1",name:"symbols1"},{icon:"symbols2",name:"symbols2"}]},null,8,["modelValue"])]),w(c,{class:"keyboard",mode:e.keyboardMode,"symbol-drop":!1,onKeyboardKeyPress:s.keyPress,onKeyboardSwapChar:s.swapChar},null,8,["mode","onKeyboardKeyPress","onKeyboardSwapChar"])])],34)}var Jo=x(zo,[["render",Qo],["__scopeId","data-v-f5965b9e"]]);const Zo={name:"WDecoBand",props:{size:{type:Number,default:0}},computed:{strips:function(){return[...Array(this.size).keys()]},stripTop:function(){const e={},t=this.$tileMap("deco-band-top");return e.backgroundImage=`url(${t.url})`,e},stripBottom:function(){const e={},t=this.$tileMap("deco-band-bottom");return e.backgroundImage=`url(${t.url})`,e},textPosition:function(){const e={};return e.top=`calc(${this.size-2} * 4px * var(--global-ss))`,e}}},es={class:"band"},ts={class:"strip"},os={class:"strip"},ss={class:"strip strip-half"};function as(e,t,o,a,i,s){return d(),f("div",es,[h("div",{class:"text",style:g(s.textPosition)},[L(e.$slots,"default",{},void 0,!0)],4),h("div",ts,[h("div",{style:g(s.stripBottom),class:"tile half-tile"},null,4)]),h("div",os,[h("div",{style:g(s.stripBottom),class:"tile"},null,4)]),h("div",ss,[h("div",{style:g(s.stripTop),class:"tile"},null,4),h("div",{style:g(s.stripBottom),class:"tile"},null,4)]),(d(!0),f(T,null,D(s.strips,r=>(d(),f("div",{key:r,class:"strip",style:g({marginTop:`calc(8px * var(--global-ss) * ${r})`})},[h("div",{style:g(s.stripTop),class:"tile"},null,4),h("div",{style:g(s.stripBottom),class:"tile"},null,4)],4))),128))])}var is=x(Zo,[["render",as],["__scopeId","data-v-3993ed11"]]);const ns={name:{component:Q(oo),topHint:"Please choose a name"},color:{component:Q(uo),topHint:"Please select a color"},options:{component:Q(Mo),topHint:"Please customize the experience"},lobby:{component:Q(Ho),topHint:"Please choose a room to connect"},"custom-server":{component:Q(Jo),topHint:"Choose a custom server to connect to"}},rs={name:"Home",components:{WDecoBand:is,WButton:W},props:{loadView:{type:String,default:"name"},providedRoomCode:{type:String,default:null},providedServerAddress:{type:String,default:null}},data:function(){return{view:void 0,views:ns,onBackThrottled:void 0,onDoneThrottled:void 0,scrollUpIndicator:!1,scrollDownIndicator:!1}},computed:{componentStyle:function(){this.$global.superSample;const e={},t=this.$tileMap("grid-background-blank");return e.backgroundImage=`url(${t.url})`,e},scrollUpStyle:function(){return this.$global.superSample,{backgroundImage:`url(${this.$tileMap("icon-normal-arrow-up").url})`}},scrollDownStyle:function(){return this.$global.superSample,{backgroundImage:`url(${this.$tileMap("icon-normal-arrow-down").url})`}},canGoBack:function(){return this.view!=="name"}},created:function(){this.view=this.loadView,this.onBackThrottled=m.exports.throttle(this.onBack,666,{leading:!0}),this.onDoneThrottled=m.exports.throttle(this.onDone,666,{leading:!0}),this.onMiddleScrollThrottled=m.exports.throttle(this.onMiddleScroll,333,{leading:!1,trailing:!0}),this.providedRoomCode!==null&&(this.$global.roomCode=this.providedRoomCode),this.providedServerAddress!==null&&(this.$global.serverAddress=this.providedServerAddress),(this.providedRoomCode!==null||this.providedServerAddress!==null)&&this.$router.replace({name:"Home",props:{v:this.view}})},mounted:function(){this.viewObserver=new ResizeObserver(this.onMiddleScrollThrottled).observe(this.$refs.middle)},beforeUnmount:function(){this.viewObserver&&this.viewObserver.unobserve(this.$refs.middle),this.onBackThrottled.cancel(),this.onBackThrottled=void 0,this.onDoneThrottled.cancel(),this.onDoneThrottled=void 0,this.onMiddleScrollThrottled.cancel(),this.onMiddleScrollThrottled=void 0},methods:{nameSelected:function(e){this.$global.userName=e},colorSelected:function(e){this.$global.userColorIndex=e},customServer:function(){this.view="custom-server",this.viewChanged()},onDone:function(){this.$refs.component.done()},onBack:function(){this.view!=="name"&&this.$refs.component.back()},goToChat:function(){this.$global.audio.playProgram("pc-enter");const e=this.$global.chatClient;this.$router.replace({name:"Chat",query:{r:e&&e.connected?e.roomCode:void 0}})},onDoneCompleted:function(){if(this.view==="name")this.view="color";else if(this.view==="color")this.view="options";else if(this.view==="options")this.view="lobby";else if(this.view==="lobby"){this.goToChat();return}else this.view==="custom-server"&&(this.view="lobby");this.viewChanged()},onBackCompleted:function(){this.view!=="name"&&(this.view==="color"?this.view="name":this.view==="options"?this.view="color":this.view==="lobby"?this.view="options":this.view==="custom-server"&&(this.view="lobby"),this.viewChanged())},viewChanged:function(){this.$router.replace({name:"Home",query:{v:this.view}}),this.$refs.middle.scrollTo(0,0),this.onMiddleScrollThrottled()},onMiddleScroll:function(){const e=this.$refs.middle;if(e==null)return;const t=e.scrollHeight-e.offsetHeight;t>3||t<-3?e.scrollTop===0?(this.scrollUpIndicator=!1,this.scrollDownIndicator=!0):Math.round(e.scrollTop)<Math.round(e.scrollHeight-e.offsetHeight)?(this.scrollUpIndicator=!0,this.scrollDownIndicator=!0):(this.scrollUpIndicator=!0,this.scrollDownIndicator=!1):(this.scrollUpIndicator=!1,this.scrollDownIndicator=!1)}}},ls=h("a",{href:"https://github.com/amlib/pictoclone",target:"_blank",class:"deco-band-link"},"Fork me!",-1),cs={class:"top"},us={class:"scroll-up-wrapper"},ds={class:"scroll-down-wrapper"},hs={class:"bottom"};function ps(e,t,o,a,i,s){const r=k("w-deco-band"),n=k("w-button");return d(),f("div",{class:"background",style:g(s.componentStyle)},[e.$global.showGithubLink?(d(),N(r,{key:0,size:4,class:_(["deco-band",e.view!=="name"&&"deco-band-fade"])},{default:S(()=>[ls]),_:1},8,["class"])):B("",!0),h("div",cs,E(e.views[e.view].topHint),1),h("div",{class:"middle",onScroll:t[0]||(t[0]=(...c)=>e.onMiddleScrollThrottled&&e.onMiddleScrollThrottled(...c)),ref:"middle"},[h("div",us,[h("div",{class:_(["scroll-indicator","scroll-up-indicator",!e.scrollUpIndicator&&"scroll-hide"]),style:g(s.scrollUpStyle)},null,6)]),h("div",ds,[h("div",{class:_(["scroll-indicator","scroll-down-indicator",!e.scrollDownIndicator&&"scroll-hide"]),style:g(s.scrollDownStyle)},null,6)]),(d(),N(pe(e.views[e.view].component),{ref:"component",style:g(s.componentStyle),class:"component",onDone:s.onDoneCompleted,onBack:s.onBackCompleted,onColorSelected:s.colorSelected,onNameSelected:s.nameSelected,onCustomServer:s.customServer},null,8,["style","onDone","onBack","onColorSelected","onNameSelected","onCustomServer"]))],544),h("div",hs,[w(n,{disabled:!s.canGoBack,class:"text-button","plate-padding":3,"normal-tile":"large-beveled-button","active-tile":"large-beveled-button-inverted",onClick:e.onBackThrottled,"audio-feedback":""},{default:S(()=>[$(E(e.view==="custom-server"?"Cancel":"Back"),1)]),_:1},8,["disabled","onClick"]),w(n,{class:"text-button","plate-padding":3,"normal-tile":"large-beveled-button","active-tile":"large-beveled-button-inverted",onClick:e.onDoneThrottled,"audio-feedback":""},{default:S(()=>[$(E(e.view==="custom-server"?"Confirm":"Next"),1)]),_:1},8,["onClick"])])],4)}var fs=x(rs,[["render",ps]]);const gs=[{path:"/",name:"Home",component:fs,props:e=>({loadView:e.query.v,providedRoomCode:e.query.r,providedServerAddress:e.query.s}),meta:{portraitConstrainRatio:11.5/9,landscapeBreakpointRatio:18/9,landscapeConstrainRatio:23/9}},{path:"/chat",name:"Chat",component:()=>St(()=>import("./Chat.8b2e016f.js"),["assets/Chat.8b2e016f.js","assets/Chat.d493fe72.css","assets/vendor.52034c81.js"]),props:e=>({roomCode:e.query.r}),meta:{portraitConstrainRatio:8/9,landscapeBreakpointRatio:18/9,landscapeConstrainRatio:26/9}}],ms=ze({history:qe(),routes:gs}),de={},bs=function(e,t,o,a){const i=t.getImageData(0,0,e.width,e.height);let s=i.data;const r=o+"-"+a;let n={};if(de[r])n=de[r];else{const c=[ae[o],J[o],we[o],ve[o]],l=[ae[a],J[a],we[a],ve[a]];for(let u=0;u<c.length;++u){const p=c[u],M=l[u],y=Ne(p),P=Ne(M);n[y.r]||(n[y.r]={}),n[y.r][y.g]||(n[y.r][y.g]={}),n[y.r][y.g][y.b]=P}de[r]=n}for(let c=0;c<s.length;c+=4){const l=n?.[s[c]]?.[s[c+1]]?.[s[c+2]];l&&(s[c]=l.r,s[c+1]=l.g,s[c+2]=l.b)}return i};let H,Ve={};const Oe={generate:function(e={}){return new Promise((t,o)=>{const a={...Ve,...e};Ve=a;const i={},s=document.createElement("canvas"),r=Math.floor(a.superSample),n=a.superSample/r;if(s.getContext){const c=s.getContext("2d"),l=new Image;l.src=a.imageSource,l.onload=()=>{const u=[];for(let M=0;M<Be.length;++M){const y=Be[M];for(let P=0;P<y.map.length;++P){let I;y.colorVariations?I=[...Array(J.length).keys()]:I=[te];for(let Y=0;Y<I.length;++Y){const R=y.map[P],C={},ee=I[Y],A=R.noSuperSample?1:a.superSample;s.width=Math.floor(R.w*A),s.height=Math.floor(R.h*A);const Ie=R.x+y.x,Le=R.y+y.y,X=R.w,G=R.h;C.backgroundRepeat=R.backgroundRepeat,C.backgroundPosition=R.backgroundPosition;const he=y.groupName+"-"+R.alias;C.alias=he+(y.colorVariations?"-cv"+ee:""),C.top=Math.floor(R.top*A),C.bottom=Math.floor(R.bottom*A),C.left=Math.floor(R.left*A),C.right=Math.floor(R.right*A),C.offsetX=Math.floor(R.offsetX*A),C.offsetY=Math.floor(R.offsetY*A),C.w=Math.floor(X*A),C.h=Math.floor(G*A),C.cv=y.colorVariations;const oe=y.colorVariations&&ee!==te;c.globalCompositeOperation="copy",c.imageSmoothingEnabled=!1;const K=R.noSuperSample?1:r;c.drawImage(l,Ie,Le,X,G,0,0,X*(oe?1:K),G*(oe?1:K)),oe&&(c.putImageData(bs(s,c,te,ee),0,0),K!==1&&c.drawImage(s,0,0,X,G,0,0,X*K,G*K)),!R.noSuperSample&&n>1.01&&(c.imageSmoothingEnabled=!0,c.drawImage(s,0,0,X*K,G*K,0,0,Math.floor(X*A),Math.floor(G*A)));const Ue=async()=>{const Ye=await ko(s);C.url=URL.createObjectURL(Ye),i[C.alias]=C,y.colorVariations&&ee===te&&(i[he]=C)};u.push(Ue())}}}if(H)for(var p in H)URL.revokeObjectURL(H[p].url);Promise.all(u).then(()=>{s.remove(),l.remove(),H=i,t()})},l.onerror=function(u){console.warn("Could not load image",u),s.remove(),l.remove(),o(u)}}else console.warn("could not get canvas for mapper!"),s.remove(),o(new Error("could not get canvas context"))})},install:(e,t={})=>{e.config.unwrapInjectedRef=!0,e.config.globalProperties.$mapperGenerate=async o=>Oe.generate({...t,...o}),e.config.globalProperties.$tileMap=(o,a=null)=>a==null||!H[o].cv?H[o]:H[o+"-cv"+a]}};je(kt).use(ms).use(Oe).mount("#app");export{re as K,No as M,j as W,x as _,Qe as a,Se as b,we as c,le as d,W as e,vs as f,ko as g,Ne as h,ws as r};
